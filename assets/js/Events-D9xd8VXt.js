import{_ as S,a as c,o as u,b as t,d as w,n as U,t as i,m,c as E,e as f,C as X,q as V,s as p,v as C,y as k,l as L,F as P,r as q,D as x,E as Y,i as F,z as A,j as Z,f as $}from"./index-DSpDc2Ld.js";const ee={name:"EventCard",props:{event:Object,isAdmin:Boolean},methods:{getTypeBadgeClass(s){return{practice:"bg-primary",rehearsal:"bg-info",performance:"bg-success",meeting:"bg-secondary",workshop:"bg-warning",social:"bg-purple"}[s]||"bg-secondary"},getStatusBadgeClass(s){return{upcoming:"bg-success",ongoing:"bg-warning",completed:"bg-secondary",cancelled:"bg-danger"}[s]||"bg-secondary"},getTypeDisplay(s){return{practice:"Practice",rehearsal:"Rehearsal",performance:"Performance",meeting:"Meeting",workshop:"Workshop",social:"Social"}[s]||s},getStatusDisplay(s){return{upcoming:"Upcoming",ongoing:"Ongoing",completed:"Completed",cancelled:"Cancelled"}[s]||s},truncateDescription(s){return s.length>120?s.substring(0,120)+"...":s},formatDate(s){return new Date(s).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"})},formatTime(s){return new Date(s).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}}},te={class:"event-card card border-0 shadow-sm h-100"},ne={class:"card-body"},se={class:"d-flex justify-content-between align-items-start mb-3"},ae={key:0,class:"dropdown"},oe={class:"dropdown-menu"},le={class:"card-title text-primary"},ie={class:"card-text text-muted small"},re={class:"event-details"},de={class:"d-flex align-items-center mb-2"},ue={class:"d-flex align-items-center mb-2"},ve={class:"d-flex align-items-center mb-3"},ce={class:"text-truncate"},me={class:"d-grid gap-2"};function fe(s,e,o,n,g,v){return u(),c("div",te,[t("div",ne,[t("div",se,[t("div",null,[t("span",{class:U(["badge mb-2",v.getTypeBadgeClass(o.event.type)])},i(v.getTypeDisplay(o.event.type)),3),t("span",{class:U(["badge ms-1",v.getStatusBadgeClass(o.event.status)])},i(v.getStatusDisplay(o.event.status)),3)]),o.isAdmin?(u(),c("div",ae,[e[5]||(e[5]=t("button",{class:"btn btn-sm btn-outline-secondary border-0",type:"button","data-bs-toggle":"dropdown"},[t("i",{class:"fas fa-ellipsis-v"})],-1)),t("ul",oe,[t("li",null,[t("a",{class:"dropdown-item",href:"#",onClick:e[0]||(e[0]=l=>s.$emit("edit",o.event))},[...e[3]||(e[3]=[t("i",{class:"fas fa-edit me-2"},null,-1),m("Edit",-1)])])]),t("li",null,[t("a",{class:"dropdown-item text-danger",href:"#",onClick:e[1]||(e[1]=l=>s.$emit("delete",o.event.id))},[...e[4]||(e[4]=[t("i",{class:"fas fa-trash me-2"},null,-1),m("Delete",-1)])])])])])):w("",!0)]),t("h5",le,i(o.event.title),1),t("p",ie,i(v.truncateDescription(o.event.description)),1),t("div",re,[t("div",de,[e[6]||(e[6]=t("i",{class:"fas fa-calendar text-primary me-2"},null,-1)),t("small",null,i(v.formatDate(o.event.start_date)),1)]),t("div",ue,[e[7]||(e[7]=t("i",{class:"fas fa-clock text-primary me-2"},null,-1)),t("small",null,i(v.formatTime(o.event.start_date))+" - "+i(v.formatTime(o.event.end_date)),1)]),t("div",ve,[e[8]||(e[8]=t("i",{class:"fas fa-map-marker-alt text-primary me-2"},null,-1)),t("small",ce,i(o.event.location),1)])]),t("div",me,[t("button",{class:"btn btn-outline-primary btn-sm",onClick:e[2]||(e[2]=l=>s.$emit("view",o.event))},[...e[9]||(e[9]=[t("i",{class:"fas fa-eye me-1"},null,-1),m(" View Details ",-1)])])])])])}const ge=S(ee,[["render",fe],["__scopeId","data-v-43b4f4fa"]]),pe={name:"EventForm",props:{event:{type:Object,default:null}},emits:["save","close"],setup(s,{emit:e}){const o=E(()=>!!s.event),n=f(!1),g=f({title:"",type:"",status:"upcoming",description:"",startDate:"",endDate:"",location:""});return X(()=>s.event,l=>{l&&(g.value={...l})},{immediate:!0}),{formData:g,isEditing:o,handleSubmit:async()=>{n.value=!0;try{e("save",{...g.value})}finally{n.value=!1}},loading:n}}},be={class:"modal-content event-form-modal"},ye={class:"modal-header"},we={class:"form-group"},Ee={class:"form-group"},De={class:"form-group"},Ce={class:"form-group"},xe={class:"form-group"},he={class:"form-group"},ke={class:"form-group"},Se={class:"form-actions"},_e=["disabled"];function Fe(s,e,o,n,g,v){return u(),c("div",{class:"modal-overlay",onClick:e[10]||(e[10]=V(l=>s.$emit("close"),["self"]))},[t("div",be,[t("div",ye,[t("h2",null,i(n.isEditing?"Edit Event":"Create Event"),1),t("button",{class:"close-btn",onClick:e[0]||(e[0]=l=>s.$emit("close"))},"Ã—")]),t("form",{onSubmit:e[9]||(e[9]=V((...l)=>n.handleSubmit&&n.handleSubmit(...l),["prevent"])),class:"modal-body"},[t("div",we,[e[11]||(e[11]=t("label",null,"Title *",-1)),p(t("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=l=>n.formData.title=l),required:""},null,512),[[C,n.formData.title]])]),t("div",Ee,[e[13]||(e[13]=t("label",null,"Type *",-1)),p(t("select",{"onUpdate:modelValue":e[2]||(e[2]=l=>n.formData.type=l),required:""},[...e[12]||(e[12]=[L('<option value="" data-v-c415bd5b>Select type</option><option value="practice" data-v-c415bd5b>Practice</option><option value="rehearsal" data-v-c415bd5b>Rehearsal</option><option value="performance" data-v-c415bd5b>Performance</option><option value="meeting" data-v-c415bd5b>Meeting</option><option value="workshop" data-v-c415bd5b>Workshop</option><option value="social" data-v-c415bd5b>Social</option>',7)])],512),[[k,n.formData.type]])]),t("div",De,[e[15]||(e[15]=t("label",null,"Status *",-1)),p(t("select",{"onUpdate:modelValue":e[3]||(e[3]=l=>n.formData.status=l),required:""},[...e[14]||(e[14]=[t("option",{value:"upcoming"},"Upcoming",-1),t("option",{value:"ongoing"},"Ongoing",-1),t("option",{value:"completed"},"Completed",-1),t("option",{value:"cancelled"},"Cancelled",-1)])],512),[[k,n.formData.status]])]),t("div",Ce,[e[16]||(e[16]=t("label",null,"Description *",-1)),p(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=l=>n.formData.description=l),required:""},null,512),[[C,n.formData.description]])]),t("div",xe,[e[17]||(e[17]=t("label",null,"Start *",-1)),p(t("input",{type:"datetime-local","onUpdate:modelValue":e[5]||(e[5]=l=>n.formData.startDate=l),required:""},null,512),[[C,n.formData.startDate]])]),t("div",he,[e[18]||(e[18]=t("label",null,"End *",-1)),p(t("input",{type:"datetime-local","onUpdate:modelValue":e[6]||(e[6]=l=>n.formData.endDate=l),required:""},null,512),[[C,n.formData.endDate]])]),t("div",ke,[e[19]||(e[19]=t("label",null,"Location *",-1)),p(t("input",{type:"text","onUpdate:modelValue":e[7]||(e[7]=l=>n.formData.location=l),required:""},null,512),[[C,n.formData.location]])]),t("div",Se,[t("button",{type:"submit",disabled:n.loading},i(n.loading?"Saving...":n.isEditing?"Update":"Create"),9,_e),t("button",{type:"button",onClick:e[8]||(e[8]=l=>s.$emit("close"))},"Cancel")])],32)])])}const Te=S(pe,[["render",Fe],["__scopeId","data-v-c415bd5b"]]),Ue={name:"EventDetails",props:{event:{type:Object,required:!0}},methods:{formatDate(s){return new Date(s).toLocaleString()}}},Ve={class:"event-details"},Ae={key:0},Le={key:0},Pe={key:1};function qe(s,e,o,n,g,v){return u(),c("div",Ve,[t("h2",null,i(o.event.title),1),t("p",null,[e[0]||(e[0]=t("strong",null,"Type:",-1)),m(" "+i(o.event.type),1)]),t("p",null,[e[1]||(e[1]=t("strong",null,"Status:",-1)),m(" "+i(o.event.status),1)]),t("p",null,[e[2]||(e[2]=t("strong",null,"Start:",-1)),m(" "+i(v.formatDate(o.event.startDate)),1)]),t("p",null,[e[3]||(e[3]=t("strong",null,"End:",-1)),m(" "+i(v.formatDate(o.event.endDate)),1)]),t("p",null,[e[4]||(e[4]=t("strong",null,"Location:",-1)),m(" "+i(o.event.location),1)]),t("p",null,[e[5]||(e[5]=t("strong",null,"Description:",-1)),m(" "+i(o.event.description),1)]),o.event.schedule.length?(u(),c("div",Ae,[e[6]||(e[6]=t("h3",null,"Schedule",-1)),t("ul",null,[(u(!0),c(P,null,q(o.event.schedule,(l,b)=>(u(),c("li",{key:b},[t("strong",null,i(l.time)+":",1),m(" "+i(l.activity)+" ",1),l.description?(u(),c("em",Le,"("+i(l.description)+")",1)):w("",!0)]))),128))])])):w("",!0),o.event.additionalNotes?(u(),c("div",Pe,[e[7]||(e[7]=t("h3",null,"Additional Notes",-1)),t("p",null,i(o.event.additionalNotes),1)])):w("",!0)])}const Be=S(Ue,[["render",qe],["__scopeId","data-v-e5405c3f"]]),h={async getEvents(s={}){return await x.get("/events/",{params:s})},async getEvent(s){return await x.get(`/events/${s}/`)},async createEvent(s){return await x.post("/events/",s)},async updateEvent(s,e){return await x.patch(`/events/${s}/`,e)},async deleteEvent(s){return await x.delete(`/events/${s}/`)}},Ne="/api/v1/users/",je=async()=>{try{const s=localStorage.getItem("access_token");return s?(await Y.get(`${Ne}me/`,{headers:{Authorization:`Bearer ${s}`}})).data:null}catch(s){return console.error("Failed to fetch current user:",s),null}},Me={getCurrentUser:je},Ie={name:"Events",components:{EventCard:ge,EventForm:Te,EventDetails:Be},setup(){const s=f([]),e=f(!1),o=f(null),n=f(!1),g=f(!1),v=f(null),l=f(!1),b=f(""),y=f(""),d=f(""),B=E(()=>{const a=new Date;return s.value.filter(r=>new Date(r.start_date)>=a&&r.status==="upcoming").length}),N=E(()=>s.value.filter(a=>a.type==="practice").length),j=E(()=>s.value.filter(a=>a.type==="performance").length),M=E(()=>s.value.length),I=E(()=>b.value||y.value||d.value),O=E(()=>{let a=s.value;if(b.value){const r=b.value.toLowerCase();a=a.filter(D=>D.title.toLowerCase().includes(r)||D.description.toLowerCase().includes(r)||D.location.toLowerCase().includes(r))}return y.value&&(a=a.filter(r=>r.type===y.value)),d.value&&(a=a.filter(r=>r.status===d.value)),a}),R=async()=>{try{const a=await Me.getCurrentUser();l.value=a.data.is_staff||a.data.is_superuser||a.data.role==="admin"}catch(a){console.error("Admin check failed:",a),l.value=!1}},_=async()=>{e.value=!0,o.value=null;try{const a={};y.value&&(a.type=y.value),d.value&&(a.status=d.value);const r=await h.getEvents(a);s.value=r.data.results||r.data}catch(a){console.error("Events fetch failed:",a),o.value=a.response?.data?.message||"Failed to load events. Please try again."}finally{e.value=!1}},z=async()=>{await _()},Q=()=>{b.value="",y.value="",d.value=""},W=(a=null)=>{v.value=a,n.value=!0},T=()=>{n.value=!1,v.value=null},J=a=>{v.value=a,g.value=!0},G=()=>{g.value=!1,v.value=null},H=async a=>{try{let r;v.value?(r=await h.updateEvent(v.value.id,a),s.value=s.value.map(D=>D.id===r.data.id?r.data:D)):(r=await h.createEvent(a),s.value.push(r.data))}catch(r){throw console.error("Save event failed:",r),r}T()},K=async a=>{if(confirm("Are you sure you want to delete this event? This action cannot be undone."))try{await h.deleteEvent(a),s.value=s.value.filter(r=>r.id!==a)}catch(r){console.error("Delete event failed:",r),alert("Failed to delete event. Please try again.")}};return $(async()=>{await R(),await _()}),{events:s,loading:e,error:o,showForm:n,showDetails:g,selectedEvent:v,isAdmin:l,searchQuery:b,filterType:y,filterStatus:d,upcomingEventsCount:B,practiceEventsCount:N,performanceEventsCount:j,totalEventsCount:M,filteredEvents:O,hasActiveFilters:I,openForm:W,closeForm:T,openDetails:J,closeDetails:G,saveEvent:H,deleteEvent:K,refreshEvents:z,fetchEvents:_,clearFilters:Q}}},Oe={class:"events-page"},Re={class:"container my-5 pt-4"},ze={class:"d-flex justify-content-between align-items-center mb-4"},Qe={class:"d-flex gap-2"},We={key:0,class:"row mb-4"},Je={class:"col-md-3 mb-3"},Ge={class:"card border-0 bg-primary text-white shadow-sm"},He={class:"card-body text-center"},Ke={class:"col-md-3 mb-3"},Xe={class:"card border-0 bg-success text-white shadow-sm"},Ye={class:"card-body text-center"},Ze={class:"col-md-3 mb-3"},$e={class:"card border-0 bg-info text-white shadow-sm"},et={class:"card-body text-center"},tt={class:"col-md-3 mb-3"},nt={class:"card border-0 bg-warning text-white shadow-sm"},st={class:"card-body text-center"},at={class:"card border-0 shadow-sm mb-4"},ot={class:"card-body"},lt={class:"row align-items-center"},it={class:"col-md-6"},rt={class:"input-group"},dt={class:"col-md-6 text-md-end mt-2 mt-md-0"},ut={class:"text-muted"},vt={key:1,class:"text-center py-5"},ct={key:2,class:"alert alert-danger d-flex align-items-center",role:"alert"},mt={class:"mb-0"},ft={key:3,class:"text-center py-5"},gt={key:0,class:"text-muted mb-4"},pt={key:1,class:"text-muted mb-4"},bt={key:4,class:"row g-4"};function yt(s,e,o,n,g,v){const l=F("EventCard"),b=F("EventForm"),y=F("EventDetails");return u(),c("div",Oe,[t("div",Re,[t("div",ze,[e[12]||(e[12]=t("div",null,[t("h1",{class:"display-5 fw-bold text-primary"},"Choir Events"),t("p",{class:"text-muted"},"Join us for musical celebrations and community gatherings")],-1)),t("div",Qe,[p(t("select",{class:"form-select","onUpdate:modelValue":e[0]||(e[0]=d=>n.filterType=d),style:{width:"180px"}},[...e[8]||(e[8]=[L('<option value="" data-v-6a95e524>All Event Types</option><option value="practice" data-v-6a95e524>Practice</option><option value="rehearsal" data-v-6a95e524>Rehearsal</option><option value="performance" data-v-6a95e524>Performance</option><option value="meeting" data-v-6a95e524>Meeting</option><option value="workshop" data-v-6a95e524>Workshop</option><option value="social" data-v-6a95e524>Social Event</option>',7)])],512),[[k,n.filterType]]),p(t("select",{class:"form-select","onUpdate:modelValue":e[1]||(e[1]=d=>n.filterStatus=d),style:{width:"150px"}},[...e[9]||(e[9]=[t("option",{value:""},"All Status",-1),t("option",{value:"upcoming"},"Upcoming",-1),t("option",{value:"ongoing"},"Ongoing",-1),t("option",{value:"completed"},"Completed",-1)])],512),[[k,n.filterStatus]]),t("button",{class:"btn btn-outline-primary",onClick:e[2]||(e[2]=(...d)=>n.refreshEvents&&n.refreshEvents(...d))},[...e[10]||(e[10]=[t("i",{class:"fas fa-refresh me-1"},null,-1),m(" Refresh ",-1)])]),n.isAdmin?(u(),c("button",{key:0,class:"btn btn-primary",onClick:e[3]||(e[3]=d=>n.openForm())},[...e[11]||(e[11]=[t("i",{class:"fas fa-plus-circle me-1"},null,-1),m(" Create Event ",-1)])])):w("",!0)])]),n.loading?w("",!0):(u(),c("div",We,[t("div",Je,[t("div",Ge,[t("div",He,[e[13]||(e[13]=t("i",{class:"fas fa-calendar-alt fa-2x mb-2"},null,-1)),t("h3",null,i(n.upcomingEventsCount),1),e[14]||(e[14]=t("p",{class:"mb-0"},"Upcoming",-1))])])]),t("div",Ke,[t("div",Xe,[t("div",Ye,[e[15]||(e[15]=t("i",{class:"fas fa-music fa-2x mb-2"},null,-1)),t("h3",null,i(n.practiceEventsCount),1),e[16]||(e[16]=t("p",{class:"mb-0"},"Practices",-1))])])]),t("div",Ze,[t("div",$e,[t("div",et,[e[17]||(e[17]=t("i",{class:"fas fa-users fa-2x mb-2"},null,-1)),t("h3",null,i(n.performanceEventsCount),1),e[18]||(e[18]=t("p",{class:"mb-0"},"Performances",-1))])])]),t("div",tt,[t("div",nt,[t("div",st,[e[19]||(e[19]=t("i",{class:"fas fa-chart-line fa-2x mb-2"},null,-1)),t("h3",null,i(n.totalEventsCount),1),e[20]||(e[20]=t("p",{class:"mb-0"},"Total Events",-1))])])])])),t("div",at,[t("div",ot,[t("div",lt,[t("div",it,[t("div",rt,[e[21]||(e[21]=t("span",{class:"input-group-text bg-transparent border-end-0"},[t("i",{class:"fas fa-search text-muted"})],-1)),p(t("input",{type:"text",class:"form-control border-start-0",placeholder:"Search events by title, description, or location...","onUpdate:modelValue":e[4]||(e[4]=d=>n.searchQuery=d)},null,512),[[C,n.searchQuery]])])]),t("div",dt,[t("small",ut," Showing "+i(n.filteredEvents.length)+" of "+i(n.events.length)+" events ",1)])])])]),n.loading?(u(),c("div",vt,[...e[22]||(e[22]=[t("div",{class:"spinner-border text-primary",role:"status",style:{width:"3rem",height:"3rem"}},[t("span",{class:"visually-hidden"},"Loading...")],-1),t("p",{class:"mt-3 fs-5 text-muted"},"Loading events...",-1)])])):n.error?(u(),c("div",ct,[e[24]||(e[24]=t("i",{class:"fas fa-exclamation-triangle me-3 fa-2x"},null,-1)),t("div",null,[e[23]||(e[23]=t("h5",{class:"alert-heading"},"Failed to load events",-1)),t("p",mt,i(n.error),1),t("button",{class:"btn btn-outline-danger btn-sm mt-2",onClick:e[5]||(e[5]=(...d)=>n.fetchEvents&&n.fetchEvents(...d))}," Try Again ")])])):n.filteredEvents.length===0?(u(),c("div",ft,[e[26]||(e[26]=t("i",{class:"fas fa-calendar-times fa-4x text-muted mb-3"},null,-1)),e[27]||(e[27]=t("h3",{class:"text-muted"},"No Events Found",-1)),n.hasActiveFilters?(u(),c("p",gt," Try adjusting your search criteria or filters. ")):(u(),c("p",pt," No events scheduled yet. Check back later or create an event to get started. ")),n.isAdmin?(u(),c("button",{key:2,class:"btn btn-primary btn-lg",onClick:e[6]||(e[6]=d=>n.openForm())},[...e[25]||(e[25]=[t("i",{class:"fas fa-plus me-2"},null,-1),m("Create First Event ",-1)])])):(u(),c("button",{key:3,class:"btn btn-outline-primary",onClick:e[7]||(e[7]=(...d)=>n.clearFilters&&n.clearFilters(...d))}," Clear Filters "))])):(u(),c("div",bt,[(u(!0),c(P,null,q(n.filteredEvents,d=>(u(),c("div",{key:d.id,class:"col-12 col-md-6 col-lg-4"},[Z(l,{event:d,onView:n.openDetails,onEdit:n.openForm,onDelete:n.deleteEvent,"is-admin":n.isAdmin},null,8,["event","onView","onEdit","onDelete","is-admin"])]))),128))])),n.showForm?(u(),A(b,{key:5,event:n.selectedEvent,onClose:n.closeForm,onSave:n.saveEvent},null,8,["event","onClose","onSave"])):w("",!0),n.showDetails?(u(),A(y,{key:6,event:n.selectedEvent,onClose:n.closeDetails},null,8,["event","onClose"])):w("",!0)])])}const Et=S(Ie,[["render",yt],["__scopeId","data-v-6a95e524"]]);export{Et as default};
