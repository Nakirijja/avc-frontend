import{_ as y,a as i,o,b as t,t as l,m as u,d as f,F as b,r as h,n as p,p as m}from"./index-DSpDc2Ld.js";const v={name:"AttendanceView",data(){return{members:[],recentAttendance:[],loading:!1,processingAttendance:{},stats:{totalMembers:0,presentToday:0,absentToday:0,attendanceRate:0}}},computed:{currentDate(){return new Date().toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})},voiceDistribution(){const s={};return this.members.forEach(e=>{const r=e.voice_type||"Other";s[r]=(s[r]||0)+1}),Object.entries(s).map(([e,r])=>({type:e,count:r,percentage:(r/this.members.length*100).toFixed(1)}))}},async mounted(){await this.loadData()},methods:{async loadData(){this.loading=!0;try{await Promise.all([this.loadMembers(),this.loadRecentAttendance()]),this.calculateStats()}catch(s){console.error("Error loading attendance data:",s),this.$notify({type:"error",title:"Loading Error",text:"Failed to load attendance data. Please try again."})}finally{this.loading=!1}},async loadMembers(){try{const s=await m.choir.getMembers();this.members=s.data.results||s.data||[],this.stats.totalMembers=this.members.length}catch(s){throw console.error("Error loading members:",s),this.members=[],s}},async loadRecentAttendance(){try{const s=new Date().toISOString().split("T")[0],e=await m.choir.getAttendance({ordering:"-date",page_size:10});this.recentAttendance=e.data.results||e.data||[]}catch(s){throw console.error("Error loading recent attendance:",s),this.recentAttendance=[],s}},getAttendanceStatus(s){const e=new Date().toISOString().split("T")[0],r=this.recentAttendance.find(c=>c.member_id===s.id&&c.date===e);return r?r.present?{text:"Present",class:"bg-success"}:{text:"Absent",class:"bg-danger"}:{text:"Not Marked",class:"bg-warning"}},async markAttendance(s,e){this.$set(this.processingAttendance,s.id,!0);try{const r=new Date().toISOString().split("T")[0],c={member:s.id,date:r,present:e,notes:`Marked ${e?"present":"absent"} via dashboard`},n=this.recentAttendance.find(a=>a.member_id===s.id&&a.date===r);let d;n?d=await m.choir.updateAttendance(n.id,c):d=await m.choir.markAttendance(c),n?Object.assign(n,d.data):this.recentAttendance.unshift(d.data),this.calculateStats(),this.$notify({type:"success",title:"Attendance Updated",text:`${s.user} marked as ${e?"present":"absent"}`})}catch(r){console.error("Error marking attendance:",r),this.$notify({type:"error",title:"Update Failed",text:"Failed to update attendance. Please try again."})}finally{this.$set(this.processingAttendance,s.id,!1)}},async markAllPresent(){if(confirm("Mark all members as present for today?"))try{const s=new Date().toISOString().split("T")[0],e=this.members.map(r=>{const c={member:r.id,date:s,present:!0,notes:"Marked present via bulk action"};return m.choir.markAttendance(c)});await Promise.all(e),await this.loadRecentAttendance(),this.calculateStats(),this.$notify({type:"success",title:"Bulk Update Complete",text:`All ${this.members.length} members marked as present`})}catch(s){console.error("Error in bulk attendance update:",s),this.$notify({type:"error",title:"Bulk Update Failed",text:"Some attendance records failed to update. Please check individually."})}},calculateStats(){const s=new Date().toISOString().split("T")[0];let e=0;this.members.forEach(r=>{const c=this.recentAttendance.find(n=>n.member_id===r.id&&n.date===s);c&&c.present&&e++}),this.stats.presentToday=e,this.stats.absentToday=this.members.length-e,this.stats.attendanceRate=this.members.length>0?Math.round(e/this.members.length*100):0},getUserInitial(s){return s?s.charAt(0).toUpperCase():"U"},formatDate(s){return new Date(s).toLocaleDateString()},async refreshData(){await this.loadData()}}},_={class:"attendance-page"},x={class:"container-fluid pt-5"},k={class:"row mb-4"},A={class:"col-md-3 mb-3"},w={class:"card border-0 shadow-sm"},D={class:"card-body text-center"},S={class:"col-md-3 mb-3"},M={class:"card border-0 shadow-sm"},T={class:"card-body text-center"},P={class:"col-md-3 mb-3"},R={class:"card border-0 shadow-sm"},C={class:"card-body text-center"},U={class:"col-md-3 mb-3"},E={class:"card border-0 shadow-sm"},N={class:"card-body text-center"},O={class:"row"},I={class:"col-lg-8"},F={class:"card border-0 shadow-sm mb-4"},j={class:"card-header bg-white"},V={class:"d-flex justify-content-between align-items-center"},B={class:"card-title mb-0"},L={class:"d-flex gap-2"},z=["disabled"],q={class:"card-body"},G={key:0,class:"text-center py-4"},H={key:1,class:"table-responsive"},J={class:"table table-hover"},K={class:"d-flex align-items-center"},Q={class:"avatar-placeholder bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3",style:{width:"35px",height:"35px","font-size":"0.8rem"}},W={class:"text-muted"},X={class:"badge bg-info"},Y={class:"badge bg-secondary"},Z={class:"btn-group btn-group-sm"},$=["onClick","disabled"],tt=["onClick","disabled"],et={key:2,class:"text-center py-4"},st={class:"col-lg-4"},at={class:"card border-0 shadow-sm mb-4"},nt={class:"card-body"},rt={key:0,class:"text-center text-muted py-3"},dt={key:1},lt={class:"text-muted"},it={class:"text-end"},ot={class:"text-muted"},ct={class:"card border-0 shadow-sm"},ut={class:"card-body"},mt={key:0,class:"text-center text-muted py-3"},bt={key:1},ht={class:"badge bg-info me-2"},pt={class:"text-muted"};function gt(s,e,r,c,n,d){return o(),i("div",_,[t("div",x,[t("div",k,[t("div",A,[t("div",w,[t("div",D,[e[3]||(e[3]=t("i",{class:"fas fa-users fa-2x text-primary mb-2"},null,-1)),t("h3",null,l(n.stats.totalMembers),1),e[4]||(e[4]=t("p",{class:"text-muted mb-0"},"Total Members",-1))])])]),t("div",S,[t("div",M,[t("div",T,[e[5]||(e[5]=t("i",{class:"fas fa-user-check fa-2x text-success mb-2"},null,-1)),t("h3",null,l(n.stats.presentToday),1),e[6]||(e[6]=t("p",{class:"text-muted mb-0"},"Present Today",-1))])])]),t("div",P,[t("div",R,[t("div",C,[e[7]||(e[7]=t("i",{class:"fas fa-user-times fa-2x text-danger mb-2"},null,-1)),t("h3",null,l(n.stats.absentToday),1),e[8]||(e[8]=t("p",{class:"text-muted mb-0"},"Absent Today",-1))])])]),t("div",U,[t("div",E,[t("div",N,[e[9]||(e[9]=t("i",{class:"fas fa-chart-line fa-2x text-info mb-2"},null,-1)),t("h3",null,l(n.stats.attendanceRate)+"%",1),e[10]||(e[10]=t("p",{class:"text-muted mb-0"},"Overall Rate",-1))])])])]),t("div",O,[t("div",I,[t("div",F,[t("div",j,[t("div",V,[t("h5",B,"Mark Attendance - "+l(d.currentDate),1),t("div",L,[t("button",{class:"btn btn-outline-secondary",onClick:e[0]||(e[0]=a=>s.$router.push("/dashboard"))},[...e[11]||(e[11]=[t("i",{class:"fas fa-arrow-left me-1"},null,-1),u("Dashboard ",-1)])]),t("button",{class:"btn btn-primary",onClick:e[1]||(e[1]=(...a)=>d.markAllPresent&&d.markAllPresent(...a)),disabled:n.loading},[...e[12]||(e[12]=[t("i",{class:"fas fa-check-double me-1"},null,-1),u("Mark All Present ",-1)])],8,z)])])]),t("div",q,[n.loading?(o(),i("div",G,[...e[13]||(e[13]=[t("div",{class:"spinner-border text-primary",role:"status"},null,-1),t("p",{class:"text-muted mt-2"},"Loading attendance data...",-1)])])):(o(),i("div",H,[t("table",J,[e[17]||(e[17]=t("thead",null,[t("tr",null,[t("th",null,"Member"),t("th",null,"Voice Part"),t("th",null,"Role"),t("th",null,"Status"),t("th",null,"Actions")])],-1)),t("tbody",null,[(o(!0),i(b,null,h(n.members,a=>(o(),i("tr",{key:a.id},[t("td",null,[t("div",K,[t("div",Q,l(d.getUserInitial(a.user)),1),t("div",null,[t("strong",null,l(a.user||"Unknown"),1),e[14]||(e[14]=t("br",null,null,-1)),t("small",W,l(a.email||"No email"),1)])])]),t("td",null,[t("span",X,l(a.voice_type||"Not set"),1)]),t("td",null,[t("span",Y,l(a.role||"Member"),1)]),t("td",null,[t("span",{class:p(["badge",d.getAttendanceStatus(a).class])},l(d.getAttendanceStatus(a).text),3)]),t("td",null,[t("div",Z,[t("button",{class:"btn btn-outline-success",onClick:g=>d.markAttendance(a,!0),disabled:n.processingAttendance[a.id]},[...e[15]||(e[15]=[t("i",{class:"fas fa-check"},null,-1),u(" Present ",-1)])],8,$),t("button",{class:"btn btn-outline-danger",onClick:g=>d.markAttendance(a,!1),disabled:n.processingAttendance[a.id]},[...e[16]||(e[16]=[t("i",{class:"fas fa-times"},null,-1),u(" Absent ",-1)])],8,tt)])])]))),128))])])])),!n.loading&&n.members.length===0?(o(),i("div",et,[e[19]||(e[19]=t("i",{class:"fas fa-users fa-3x text-muted mb-3"},null,-1)),e[20]||(e[20]=t("h5",null,"No choir members found",-1)),e[21]||(e[21]=t("p",{class:"text-muted"},"Add choir members to start tracking attendance",-1)),t("button",{class:"btn btn-primary",onClick:e[2]||(e[2]=(...a)=>d.refreshData&&d.refreshData(...a))},[...e[18]||(e[18]=[t("i",{class:"fas fa-refresh me-1"},null,-1),u("Refresh Data ",-1)])])])):f("",!0)])])]),t("div",st,[t("div",at,[e[25]||(e[25]=t("div",{class:"card-header bg-white"},[t("h5",{class:"card-title mb-0"},[t("i",{class:"fas fa-history me-2"}),u("Recent Attendance ")])],-1)),t("div",nt,[n.recentAttendance.length===0?(o(),i("div",rt,[...e[22]||(e[22]=[t("i",{class:"fas fa-clipboard-list fa-2x mb-2"},null,-1),t("p",null,"No attendance records yet",-1)])])):(o(),i("div",dt,[(o(!0),i(b,null,h(n.recentAttendance,a=>(o(),i("div",{key:a.id,class:"d-flex justify-content-between align-items-center mb-3 p-2 border rounded"},[t("div",null,[t("strong",null,l(a.member),1),e[23]||(e[23]=t("br",null,null,-1)),t("small",lt,l(d.formatDate(a.date)),1)]),t("div",it,[t("span",{class:p(["badge",a.present?"bg-success":"bg-danger"])},l(a.present?"Present":"Absent"),3),e[24]||(e[24]=t("br",null,null,-1)),t("small",ot,l(a.member_voice),1)])]))),128))]))])]),t("div",ct,[e[27]||(e[27]=t("div",{class:"card-header bg-white"},[t("h5",{class:"card-title mb-0"},[t("i",{class:"fas fa-chart-pie me-2"}),u("Voice Part Distribution ")])],-1)),t("div",ut,[d.voiceDistribution.length===0?(o(),i("div",mt,[...e[26]||(e[26]=[t("p",null,"No member data",-1)])])):(o(),i("div",bt,[(o(!0),i(b,null,h(d.voiceDistribution,a=>(o(),i("div",{key:a.type,class:"d-flex justify-content-between align-items-center mb-2 p-2 border rounded"},[t("div",null,[t("span",ht,l(a.type),1),t("small",null,l(a.count)+" members",1)]),t("small",pt,l(a.percentage)+"%",1)]))),128))]))])])])])])])}const ft=y(v,[["render",gt],["__scopeId","data-v-028e7e31"]]);export{ft as default};
