import{_ as v,p as b,a,o as r,b as s,t as d,q as y,s as f,v as p,d as m,y as P,m as c,i as x,z as w,F as g,r as _,n as A}from"./index-DSpDc2Ld.js";const C={name:"PracticeForm",props:{practice:{type:Object,default:null}},data(){return{form:{title:"",description:"",date:"",duration:60,resource_link:"",sheet_music:null,sheet_music_name:"",status:"upcoming"},isEditMode:!1,loading:!1}},mounted(){this.practice&&this.loadPractice(this.practice)},methods:{loadPractice(e){this.isEditMode=!0,this.form.title=e.title,this.form.description=e.description,this.form.date=e.date?.slice(0,16)||"",this.form.duration=e.duration||60,this.form.resource_link=e.resource_link||"",this.form.status=e.status||"upcoming",this.form.sheet_music_name=e.sheet_music?this.extractFileName(e.sheet_music):""},extractFileName(e){return e.split("/").pop()},handleFileUpload(e){const t=e.target.files[0];t&&(this.form.sheet_music=t,this.form.sheet_music_name=t.name)},async submitForm(){this.loading=!0;try{const e=new FormData;e.append("title",this.form.title),e.append("description",this.form.description),e.append("date",this.form.date),e.append("duration",this.form.duration),e.append("resource_link",this.form.resource_link),e.append("status",this.form.status),this.form.sheet_music&&e.append("sheet_music",this.form.sheet_music),this.isEditMode&&this.practice?.id?await b.virtualPractice.updatePractice(this.practice.id,e):await b.virtualPractice.createPractice(e),this.$emit("saved"),this.close()}catch(e){console.error("Error saving practice:",e),alert("Failed to save practice. Please check all fields and try again.")}finally{this.loading=!1}},close(){this.$emit("close")}}},F={class:"practice-form-modal"},D={class:"modal-dialog"},S={class:"modal-content shadow-sm"},U={class:"modal-header"},E={class:"modal-title"},M={class:"modal-body"},V={class:"mb-3"},N={class:"mb-3"},R={class:"mb-3"},T={class:"mb-3"},j={class:"mb-3"},q={class:"mb-3"},L={key:0},z={class:"mb-3"},B={class:"modal-footer"},I=["disabled"],J={key:0,class:"spinner-border spinner-border-sm me-2"};function O(e,t,u,k,i,o){return r(),a("div",F,[s("div",{class:"modal-backdrop",onClick:t[0]||(t[0]=(...n)=>o.close&&o.close(...n))}),s("div",D,[s("div",S,[s("div",U,[s("h5",E,d(i.isEditMode?"Edit Practice":"Schedule Practice"),1),s("button",{type:"button",class:"btn-close",onClick:t[1]||(t[1]=(...n)=>o.close&&o.close(...n))})]),s("form",{onSubmit:t[10]||(t[10]=y((...n)=>o.submitForm&&o.submitForm(...n),["prevent"])),enctype:"multipart/form-data"},[s("div",M,[s("div",V,[t[11]||(t[11]=s("label",{class:"form-label"},"Title",-1)),f(s("input",{"onUpdate:modelValue":t[2]||(t[2]=n=>i.form.title=n),type:"text",class:"form-control",required:""},null,512),[[p,i.form.title]])]),s("div",N,[t[12]||(t[12]=s("label",{class:"form-label"},"Description",-1)),f(s("textarea",{"onUpdate:modelValue":t[3]||(t[3]=n=>i.form.description=n),class:"form-control",rows:"3",required:""},null,512),[[p,i.form.description]])]),s("div",R,[t[13]||(t[13]=s("label",{class:"form-label"},"Date & Time",-1)),f(s("input",{"onUpdate:modelValue":t[4]||(t[4]=n=>i.form.date=n),type:"datetime-local",class:"form-control",required:""},null,512),[[p,i.form.date]])]),s("div",T,[t[14]||(t[14]=s("label",{class:"form-label"},"Duration (minutes)",-1)),f(s("input",{"onUpdate:modelValue":t[5]||(t[5]=n=>i.form.duration=n),type:"number",min:"1",class:"form-control",required:""},null,512),[[p,i.form.duration,void 0,{number:!0}]])]),s("div",j,[t[15]||(t[15]=s("label",{class:"form-label"},"Resource Link (optional)",-1)),f(s("input",{"onUpdate:modelValue":t[6]||(t[6]=n=>i.form.resource_link=n),type:"url",class:"form-control",placeholder:"https://..."},null,512),[[p,i.form.resource_link]])]),s("div",q,[t[16]||(t[16]=s("label",{class:"form-label"},"Sheet Music (optional)",-1)),s("input",{type:"file",onChange:t[7]||(t[7]=(...n)=>o.handleFileUpload&&o.handleFileUpload(...n)),class:"form-control"},null,32),i.form.sheet_music_name?(r(),a("small",L,d(i.form.sheet_music_name),1)):m("",!0)]),s("div",z,[t[18]||(t[18]=s("label",{class:"form-label"},"Status",-1)),f(s("select",{"onUpdate:modelValue":t[8]||(t[8]=n=>i.form.status=n),class:"form-select",required:""},[...t[17]||(t[17]=[s("option",{value:"upcoming"},"Upcoming",-1),s("option",{value:"completed"},"Completed",-1),s("option",{value:"cancelled"},"Cancelled",-1)])],512),[[P,i.form.status]])])]),s("div",B,[s("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[9]||(t[9]=(...n)=>o.close&&o.close(...n))},"Cancel"),s("button",{type:"submit",class:"btn btn-primary",disabled:i.loading},[i.loading?(r(),a("span",J)):m("",!0),c(" "+d(i.isEditMode?"Update":"Create"),1)],8,I)])],32)])])])}const Y=v(C,[["render",O],["__scopeId","data-v-bdeac071"]]),G={name:"VirtualPractice",components:{PracticeForm:Y},data(){return{loading:!1,upcomingPractices:[],completedPractices:[],recentAttendance:[],isAdmin:!1,showPracticeForm:!1,stats:{}}},mounted(){this.initializePage()},methods:{async initializePage(){await this.checkAdminStatus(),this.refreshPractices(),this.loadRecentAttendance()},async refreshPractices(){this.loading=!0;try{const e=await b.virtualPractice.getPractices(),t=e.data.results||e.data;this.upcomingPractices=t.filter(u=>u.status==="upcoming"),this.completedPractices=t.filter(u=>u.status==="completed"),this.stats.upcomingPractices=this.upcomingPractices.length,this.stats.completedPractices=this.completedPractices.length}catch(e){console.error("Error loading practices:",e),this.upcomingPractices=[],this.completedPractices=[]}finally{this.loading=!1}},async loadRecentAttendance(){try{const e=await b.virtualPractice.getRecentAttendance();this.recentAttendance=e.data.results||[],this.stats.totalAttendance=this.recentAttendance.length}catch(e){console.error("Error loading recent attendance:",e),this.recentAttendance=[]}},async checkAdminStatus(){const e=b.auth.getCurrentUser();this.isAdmin=e?.role&&["admin","choirmaster"].includes(e.role)},async markAttendance(e){try{await b.virtualPractice.markAttendance(e.id),e.is_user_attending=!0,e.total_attendees=(e.total_attendees||0)+1,this.loadRecentAttendance()}catch(t){console.error("Error marking attendance:",t),alert("Unable to mark attendance. Please login or try again.")}},joinPractice(e){e.resource_link?window.open(e.resource_link,"_blank"):alert("No video link available for this practice.")},viewPracticeDetails(e){alert(`Practice Details:
Title: ${e.title}
Description: ${e.description}`)},createPractice(){this.showPracticeForm=!0,this.$emit("edit-practice",null)},editPractice(e){this.showPracticeForm=!0,this.$emit("edit-practice",e)},formatDateTime(e){return new Date(e).toLocaleString()},formatDuration(e){const t=Math.floor(e/60),u=e%60;return`${t?t+"h ":""}${u}m`},getPracticeStatusClass(e){switch(e){case"upcoming":return"badge bg-primary";case"completed":return"badge bg-success";case"cancelled":return"badge bg-danger";default:return"badge bg-secondary"}}}},H={class:"virtual-practice-page"},K={class:"container-fluid pt-5"},Q={class:"row mb-4"},W={class:"col-md-3 mb-3"},X={class:"card border-0 shadow-sm"},Z={class:"card-body text-center"},$={class:"col-md-3 mb-3"},tt={class:"card border-0 shadow-sm"},st={class:"card-body text-center"},et={class:"col-md-3 mb-3"},it={class:"card border-0 shadow-sm"},lt={class:"card-body text-center"},ot={class:"col-md-3 mb-3"},nt={class:"card border-0 shadow-sm"},rt={class:"card-body text-center"},at={class:"row"},dt={class:"col-lg-8"},ct={class:"card border-0 shadow-sm mb-4"},mt={class:"card-header bg-white d-flex justify-content-between align-items-center"},ut={class:"d-flex gap-2"},ft={class:"card-body"},bt={key:0,class:"text-center py-4"},pt={key:1,class:"text-center py-5"},ht={key:2,class:"list-group"},gt={class:"d-flex justify-content-between align-items-start"},_t={class:"flex-grow-1"},vt={class:"d-flex align-items-center mb-2"},kt={class:"mb-0 text-primary"},yt={class:"mb-2 text-muted small"},Pt={class:"mb-2 small"},xt={class:"d-flex gap-3 text-muted small"},wt={key:0},At={key:1,class:"text-success"},Ct={class:"d-flex flex-column gap-2 ms-3"},Ft=["onClick","disabled"],Dt=["onClick","disabled"],St=["onClick"],Ut=["onClick"],Et={key:0,class:"mt-3 pt-3 border-top"},Mt={class:"d-flex gap-2"},Vt=["href"],Nt={class:"col-lg-4"},Rt={class:"card border-0 shadow-sm mb-4"},Tt={class:"card-body"},jt={class:"list-group list-group-flush"},qt={class:"text-muted small"},Lt={key:0,class:"list-group-item text-center text-muted small"};function zt(e,t,u,k,i,o){const n=x("PracticeForm");return r(),a("div",H,[s("div",K,[s("div",Q,[s("div",W,[s("div",X,[s("div",Z,[t[4]||(t[4]=s("i",{class:"fas fa-calendar-check fa-2x text-primary mb-2"},null,-1)),s("h3",null,d(i.stats.upcomingPractices||0),1),t[5]||(t[5]=s("p",{class:"text-muted mb-0"},"Upcoming Practices",-1))])])]),s("div",$,[s("div",tt,[s("div",st,[t[6]||(t[6]=s("i",{class:"fas fa-users fa-2x text-success mb-2"},null,-1)),s("h3",null,d(i.stats.totalAttendance||0),1),t[7]||(t[7]=s("p",{class:"text-muted mb-0"},"Total Attendance",-1))])])]),s("div",et,[s("div",it,[s("div",lt,[t[8]||(t[8]=s("i",{class:"fas fa-clock fa-2x text-info mb-2"},null,-1)),s("h3",null,d(i.stats.averageAttendance||0)+"%",1),t[9]||(t[9]=s("p",{class:"text-muted mb-0"},"Avg Attendance Rate",-1))])])]),s("div",ot,[s("div",nt,[s("div",rt,[t[10]||(t[10]=s("i",{class:"fas fa-music fa-2x text-warning mb-2"},null,-1)),s("h3",null,d(i.stats.completedPractices||0),1),t[11]||(t[11]=s("p",{class:"text-muted mb-0"},"Completed",-1))])])])]),s("div",at,[s("div",dt,[s("div",ct,[s("div",mt,[t[14]||(t[14]=s("h5",{class:"card-title mb-0"},[s("i",{class:"fas fa-calendar me-2"}),c("Upcoming Practice Sessions ")],-1)),s("div",ut,[s("button",{class:"btn btn-outline-secondary btn-sm",onClick:t[0]||(t[0]=(...l)=>o.refreshPractices&&o.refreshPractices(...l))},[...t[12]||(t[12]=[s("i",{class:"fas fa-refresh me-1"},null,-1),c("Refresh ",-1)])]),i.isAdmin?(r(),a("button",{key:0,class:"btn btn-primary btn-sm",onClick:t[1]||(t[1]=(...l)=>o.createPractice&&o.createPractice(...l))},[...t[13]||(t[13]=[s("i",{class:"fas fa-plus me-1"},null,-1),c("Schedule Practice ",-1)])])):m("",!0)])]),s("div",ft,[i.loading?(r(),a("div",bt,[...t[15]||(t[15]=[s("div",{class:"spinner-border text-primary",role:"status"},null,-1),s("p",{class:"text-muted mt-2"},"Loading practice sessions...",-1)])])):i.upcomingPractices.length===0?(r(),a("div",pt,[t[17]||(t[17]=s("i",{class:"fas fa-calendar-times fa-3x text-muted mb-3"},null,-1)),t[18]||(t[18]=s("h5",null,"No upcoming practices scheduled",-1)),t[19]||(t[19]=s("p",{class:"text-muted"},"Check back later or schedule a new practice session",-1)),i.isAdmin?(r(),a("button",{key:0,class:"btn btn-primary mt-2",onClick:t[2]||(t[2]=(...l)=>o.createPractice&&o.createPractice(...l))},[...t[16]||(t[16]=[s("i",{class:"fas fa-plus me-2"},null,-1),c("Schedule First Practice ",-1)])])):m("",!0)])):(r(),a("div",ht,[(r(!0),a(g,null,_(i.upcomingPractices,l=>(r(),a("div",{key:l.id,class:"list-group-item list-group-item-action border-0 mb-2 rounded shadow-sm"},[s("div",gt,[s("div",_t,[s("div",vt,[s("h6",kt,d(l.title),1),s("span",{class:A(["badge ms-2",o.getPracticeStatusClass(l.status)])},d(l.status),3)]),s("p",yt,[t[20]||(t[20]=s("i",{class:"fas fa-clock me-1"},null,-1)),c(" "+d(o.formatDateTime(l.date)),1)]),s("p",Pt,d(l.description),1),s("div",xt,[s("span",null,[t[21]||(t[21]=s("i",{class:"fas fa-users me-1"},null,-1)),c(" "+d(l.total_attendees||0)+" attending",1)]),l.duration?(r(),a("span",wt,[t[22]||(t[22]=s("i",{class:"fas fa-hourglass me-1"},null,-1)),c(" "+d(o.formatDuration(l.duration)),1)])):m("",!0),l.is_user_attending?(r(),a("span",At,[...t[23]||(t[23]=[s("i",{class:"fas fa-check-circle me-1"},null,-1),c(" You're attending ",-1)])])):m("",!0)])]),s("div",Ct,[s("button",{class:"btn btn-primary btn-sm",onClick:h=>o.joinPractice(l),disabled:!l.resource_link},[t[24]||(t[24]=s("i",{class:"fas fa-video me-1"},null,-1)),c(" "+d(l.resource_link?"Join":"No Link"),1)],8,Ft),s("button",{class:"btn btn-outline-success btn-sm",onClick:h=>o.markAttendance(l),disabled:l.is_user_attending},[t[25]||(t[25]=s("i",{class:"fas fa-user-check me-1"},null,-1)),c(" "+d(l.is_user_attending?"Attending":"Mark Attendance"),1)],8,Dt),s("button",{class:"btn btn-outline-secondary btn-sm",onClick:h=>o.viewPracticeDetails(l)},[...t[26]||(t[26]=[s("i",{class:"fas fa-info-circle me-1"},null,-1),c("Details ",-1)])],8,St),i.isAdmin?(r(),a("button",{key:0,class:"btn btn-outline-warning btn-sm",onClick:h=>o.editPractice(l)},[...t[27]||(t[27]=[s("i",{class:"fas fa-edit me-1"},null,-1),c("Edit ",-1)])],8,Ut)):m("",!0)])]),l.sheet_music?(r(),a("div",Et,[t[29]||(t[29]=s("h6",{class:"small text-muted mb-2"},"Practice Resources:",-1)),s("div",Mt,[s("a",{href:l.sheet_music,class:"btn btn-outline-info btn-sm",target:"_blank"},[...t[28]||(t[28]=[s("i",{class:"fas fa-music me-1"},null,-1),c("Sheet Music ",-1)])],8,Vt)])])):m("",!0)]))),128))]))])])]),s("div",Nt,[s("div",Rt,[t[30]||(t[30]=s("div",{class:"card-header bg-white"},[s("h5",{class:"card-title mb-0"},[s("i",{class:"fas fa-user-check me-2"}),c("Recent Attendance")])],-1)),s("div",Tt,[s("ul",jt,[(r(!0),a(g,null,_(i.recentAttendance,l=>(r(),a("li",{class:"list-group-item d-flex justify-content-between align-items-center",key:l.id},[s("span",null,d(l.member.username),1),s("span",qt,d(o.formatDateTime(l.timestamp)),1)]))),128)),i.recentAttendance.length===0?(r(),a("li",Lt," No recent attendance found ")):m("",!0)])])])])])]),i.showPracticeForm?(r(),w(n,{key:0,onClose:t[3]||(t[3]=l=>i.showPracticeForm=!1),onSaved:o.refreshPractices},null,8,["onSaved"])):m("",!0)])}const It=v(G,[["render",zt],["__scopeId","data-v-70b334c4"]]);export{It as default};
