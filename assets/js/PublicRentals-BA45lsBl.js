import{_ as F,a as i,o as d,b as t,t as n,d as y,s as u,v as c,F as _,r as b,n as f,m as r,p as h}from"./index-DSpDc2Ld.js";import{M as v}from"./bootstrap.esm-C02OvDcj.js";import{_ as I}from"./lodash-DfslGzQw.js";const q={name:"PublicRentals",data(){return{items:[],categories:[],search:"",selectedItem:null,rentalForm:{guest_name:"",guest_contact:"",quantity:1,days:1,total_cost:0,payment_method:"mtn"},paymentMethods:[{id:"airtel",name:"Airtel Money",icon:"fas fa-mobile-alt"},{id:"mtn",name:"MTN Mobile Money",icon:"fas fa-mobile-alt"},{id:"paypal",name:"PayPal",icon:"fab fa-paypal"},{id:"stripe",name:"Stripe",icon:"fas fa-credit-card"},{id:"cash",name:"Cash Payment",icon:"fas fa-money-bill"}],loading:!1,userOrders:[]}},computed:{totalItems(){return this.items.length},affordableItems(){return this.items.filter(e=>parseFloat(e.price_per_day)<5e4).length},popularCategories(){return new Set(this.items.map(s=>s.category_name).filter(Boolean)).size},isFormValid(){return this.rentalForm.guest_name&&this.rentalForm.guest_contact&&this.rentalForm.quantity>0&&this.rentalForm.days>0&&this.rentalForm.payment_method}},created(){this.debouncedLoadItems=I.debounce(this.loadItems,300)},methods:{formatCurrency(e){return!e&&e!==0?"UGX 0":`UGX ${parseFloat(e).toLocaleString("en-UG")}`},truncateDescription(e){return e?e.length>100?e.substring(0,100)+"...":e:""},getStockClass(e){return e===0?"out-of-stock":e<3?"low-stock":"in-stock"},getStockText(e){return e===0?"Out of Stock":e<3?`Only ${e} Left`:"In Stock"},async loadItems(){this.loading=!0;try{console.log("ðŸ”„ Loading rental items...");const e={};this.search&&(e.search=this.search);const s=await h.rentals.getItems(e);console.log("âœ… Rental items loaded:",s.data),Array.isArray(s.data)?this.items=s.data:s.data.results?this.items=s.data.results:this.items=s.data,console.log("ðŸ“¦ Processed items:",this.items)}catch(e){console.error("âŒ Error loading rental items:",e),console.error("Error details:",e.response?.data),this.items=[]}finally{this.loading=!1}},openRentalModal(e){this.selectedItem=e,this.rentalForm={guest_name:"",guest_contact:"",quantity:1,days:1,total_cost:parseFloat(e.price_per_day),payment_method:"mtn"},new v(document.getElementById("rentalModal")).show(),document.getElementById("rentalModal").addEventListener("shown.bs.modal",()=>{this.updateTotalCost()})},updateTotalCost(){if(!this.selectedItem)return;const e=this.rentalForm.quantity||1,s=this.rentalForm.days||1,m=parseFloat(this.selectedItem.price_per_day);this.rentalForm.total_cost=e*s*m},async submitRental(){if(!this.selectedItem||!this.isFormValid){alert("Please fill in all required fields");return}if(this.rentalForm.quantity>this.selectedItem.available_quantity){alert(`Only ${this.selectedItem.available_quantity} items available`);return}const e={items:[{item:this.selectedItem.id,quantity:this.rentalForm.quantity,days:this.rentalForm.days}],guest_name:this.rentalForm.guest_name,guest_contact:this.rentalForm.guest_contact,payment_method:this.rentalForm.payment_method};console.log("ðŸ”„ Submitting rental request...",e);try{const s=await h.rentals.createOrder(e);console.log("âœ… Rental request successful:",s.data),this.showSuccessMessage();const m=v.getInstance(document.getElementById("rentalModal"));m&&m.hide(),this.loadItems(),this.rentalForm={guest_name:"",guest_contact:"",quantity:1,days:1,total_cost:0,payment_method:"mtn"}}catch(s){console.error("âŒ Error submitting rental:",s),this.handleRentalError(s)}},handleRentalError(e){if(e.response?.status===400){const s=e.response.data;let m="Validation error: ";if(typeof s=="object"){const p=[];for(const[l,o]of Object.entries(s))Array.isArray(o)?p.push(...o):typeof o=="string"&&p.push(o);m+=p.join(", ")}else m+=e.response.data;alert(m)}else e.response?.status===401?alert("Please log in to submit a rental request."):e.response?.status===403?alert("You do not have permission to submit rental requests."):e.response?.status===404?alert("The rental item was not found. Please refresh the page and try again."):e.response?.status>=500?alert("Server error. Please try again later."):alert("Failed to submit rental request. Please check your connection and try again.")},showSuccessMessage(){let e="ðŸŽ‰ Rental request submitted successfully! ";e+="We will contact you shortly to confirm your order and provide payment instructions.",alert(e)},clearSearch(){this.search="",this.loadItems()},async loadUserOrders(){if(this.$store.state.auth.user)try{const e=await h.rentals.getUserOrders();this.userOrders=e.data}catch(e){console.error("Error loading user orders:",e)}}},mounted(){this.loadItems()},watch:{"rentalForm.quantity":"updateTotalCost","rentalForm.days":"updateTotalCost"}},C={class:"rentals-page"},k={class:"rentals-hero text-white py-5"},M={class:"container py-5"},S={class:"row justify-content-center text-center"},x={class:"col-lg-8"},R={class:"hero-stats mt-4"},w={class:"stat-item"},T={class:"stat-info"},E={class:"stat-number"},P={class:"stat-item"},U={class:"stat-info"},V={class:"stat-number"},O={class:"stat-item"},N={class:"stat-info"},L={class:"stat-number"},A={class:"container py-5"},D={class:"search-section mb-5"},B={class:"search-card"},j={class:"search-header"},G={class:"search-stats"},X={class:"badge bg-primary"},z={class:"row g-4"},Y={class:"card-content"},Q={class:"item-title"},W={class:"item-meta"},H={class:"meta-item"},J={class:"meta-item"},K={key:0,class:"item-description"},Z={class:"pricing"},$={class:"price-main"},tt=["onClick","disabled"],st={key:0},et={key:1},at={key:0,class:"empty-state text-center py-5"},lt={class:"empty-text"},ot={class:"modal fade",id:"rentalModal",tabindex:"-1"},nt={class:"modal-dialog modal-lg"},rt={class:"modal-content rental-modal-content"},it={class:"modal-header"},dt={class:"modal-header-content"},mt={class:"modal-title"},ut={class:"modal-subtitle"},ct={class:"modal-body"},pt={class:"rental-process"},yt={class:"process-step active"},ft={class:"step-content"},ht={class:"row g-3"},_t={class:"col-md-6"},bt={class:"col-md-6"},vt={class:"col-md-6"},gt={class:"form-label"},Ft={class:"text-muted"},It=["max"],qt={class:"col-md-6"},Ct={class:"process-step"},kt={class:"step-content"},Mt={class:"cost-summary"},St={class:"cost-item"},xt={class:"cost-item"},Rt={class:"cost-total"},wt={class:"total-amount"},Tt={class:"payment-methods"},Et={class:"payment-options"},Pt=["onClick"],Ut={key:0,class:"momo-instructions mt-3"},Vt={class:"alert alert-info"},Ot={class:"mb-0 mt-2"},Nt={class:"modal-footer"},Lt=["disabled"];function At(e,s,m,p,l,o){return d(),i("div",C,[t("section",k,[s[18]||(s[18]=t("div",{class:"hero-overlay"},null,-1)),t("div",M,[t("div",S,[t("div",x,[s[16]||(s[16]=t("h1",{class:"display-4 fw-bold mb-4 hero-title"},"Support Our Choir",-1)),s[17]||(s[17]=t("p",{class:"lead hero-subtitle"}," Rent our equipment and help fund our musical journey. Every rental supports our choir activities. ",-1)),t("div",R,[t("div",w,[s[11]||(s[11]=t("div",{class:"stat-icon"},[t("i",{class:"fas fa-music"})],-1)),t("div",T,[t("span",E,n(o.totalItems),1),s[10]||(s[10]=t("span",{class:"stat-label"},"Items Available",-1))])]),t("div",P,[s[13]||(s[13]=t("div",{class:"stat-icon"},[t("i",{class:"fas fa-hand-holding-usd"})],-1)),t("div",U,[t("span",V,n(o.affordableItems),1),s[12]||(s[12]=t("span",{class:"stat-label"},"Under UGX 50,000/Day",-1))])]),t("div",O,[s[15]||(s[15]=t("div",{class:"stat-icon"},[t("i",{class:"fas fa-star"})],-1)),t("div",N,[t("span",L,n(o.popularCategories),1),s[14]||(s[14]=t("span",{class:"stat-label"},"Categories",-1))])])])])])])]),t("div",A,[t("div",D,[t("div",B,[t("div",j,[s[20]||(s[20]=t("i",{class:"fas fa-search search-icon"},null,-1)),u(t("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>l.search=a),onInput:s[1]||(s[1]=(...a)=>e.debouncedLoadItems&&e.debouncedLoadItems(...a)),type:"text",class:"search-input",placeholder:"Search instruments, equipment, or categories..."},null,544),[[c,l.search]]),t("div",G,[t("span",X,n(l.items.length),1),s[19]||(s[19]=t("span",{class:"text-muted"},"items found",-1))])])])]),t("div",z,[(d(!0),i(_,null,b(l.items,a=>(d(),i("div",{key:a.id,class:"col-xl-3 col-lg-4 col-md-6"},[t("div",{class:f(["rental-card",{"out-of-stock":a.available_quantity===0}])},[t("div",{class:f(["stock-badge",o.getStockClass(a.available_quantity)])},n(o.getStockText(a.available_quantity)),3),s[25]||(s[25]=t("div",{class:"item-image"},[t("i",{class:"fas fa-music"})],-1)),t("div",Y,[t("h5",Q,n(a.name),1),t("div",W,[t("div",H,[s[21]||(s[21]=t("i",{class:"fas fa-tag"},null,-1)),t("span",null,n(a.category_name||"General"),1)]),t("div",J,[s[22]||(s[22]=t("i",{class:"fas fa-box"},null,-1)),t("span",null,n(a.available_quantity)+" available",1)])]),a.description?(d(),i("p",K,n(o.truncateDescription(a.description)),1)):y("",!0),t("div",Z,[t("div",$,n(o.formatCurrency(a.price_per_day)),1),s[23]||(s[23]=t("div",{class:"price-label"},"per day",-1))]),t("button",{class:"btn-rent",onClick:g=>o.openRentalModal(a),disabled:a.available_quantity===0},[a.available_quantity===0?(d(),i("span",st,"Out of Stock")):(d(),i("span",et,[...s[24]||(s[24]=[t("i",{class:"fas fa-shopping-cart me-2"},null,-1),r(" Rent Now ",-1)])]))],8,tt)])],2)]))),128))]),l.items.length===0&&!l.loading?(d(),i("div",at,[s[26]||(s[26]=t("div",{class:"empty-icon"},[t("i",{class:"fas fa-search"})],-1)),s[27]||(s[27]=t("h4",{class:"empty-title"},"No Items Found",-1)),t("p",lt,n(l.search?"Try adjusting your search terms":"No rental items available at the moment"),1),l.search?(d(),i("button",{key:0,class:"btn btn-outline-primary",onClick:s[2]||(s[2]=(...a)=>o.clearSearch&&o.clearSearch(...a))}," Clear Search ")):y("",!0)])):y("",!0)]),t("div",ot,[t("div",nt,[t("div",rt,[t("div",it,[t("div",dt,[t("h5",mt,[s[28]||(s[28]=t("i",{class:"fas fa-shopping-cart me-2"},null,-1)),r(" Rent: "+n(l.selectedItem?.name),1)]),t("div",ut,n(l.selectedItem?.category_name),1)]),s[29]||(s[29]=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"},null,-1))]),t("div",ct,[t("div",pt,[t("div",yt,[s[36]||(s[36]=t("div",{class:"step-header"},[t("div",{class:"step-number"},"1"),t("h6",{class:"step-title"},"Rental Details")],-1)),t("div",ft,[t("div",ht,[t("div",_t,[s[30]||(s[30]=t("label",{class:"form-label"},[t("i",{class:"fas fa-user me-2"}),r("Your Full Name ")],-1)),u(t("input",{"onUpdate:modelValue":s[3]||(s[3]=a=>l.rentalForm.guest_name=a),type:"text",class:"form-control",placeholder:"Enter your name",required:""},null,512),[[c,l.rentalForm.guest_name]])]),t("div",bt,[s[31]||(s[31]=t("label",{class:"form-label"},[t("i",{class:"fas fa-phone me-2"}),r("Phone Number ")],-1)),u(t("input",{"onUpdate:modelValue":s[4]||(s[4]=a=>l.rentalForm.guest_contact=a),type:"tel",class:"form-control",placeholder:"e.g., 0751234567",pattern:"[0-9]{10}",required:""},null,512),[[c,l.rentalForm.guest_contact]]),s[32]||(s[32]=t("small",{class:"text-muted"},"Enter your 10-digit Uganda phone number",-1))]),t("div",vt,[t("label",gt,[s[33]||(s[33]=t("i",{class:"fas fa-boxes me-2"},null,-1)),s[34]||(s[34]=r("Quantity ",-1)),t("span",Ft,"(Max: "+n(l.selectedItem?.available_quantity)+")",1)]),u(t("input",{"onUpdate:modelValue":s[5]||(s[5]=a=>l.rentalForm.quantity=a),type:"number",class:"form-control",min:"1",max:l.selectedItem?.available_quantity,required:"",onInput:s[6]||(s[6]=(...a)=>o.updateTotalCost&&o.updateTotalCost(...a))},null,40,It),[[c,l.rentalForm.quantity,void 0,{number:!0}]])]),t("div",qt,[s[35]||(s[35]=t("label",{class:"form-label"},[t("i",{class:"fas fa-calendar-day me-2"}),r("Rental Days ")],-1)),u(t("input",{"onUpdate:modelValue":s[7]||(s[7]=a=>l.rentalForm.days=a),type:"number",class:"form-control",min:"1",max:"30",required:"",onInput:s[8]||(s[8]=(...a)=>o.updateTotalCost&&o.updateTotalCost(...a))},null,544),[[c,l.rentalForm.days,void 0,{number:!0}]])])])])]),t("div",Ct,[s[46]||(s[46]=t("div",{class:"step-header"},[t("div",{class:"step-number"},"2"),t("h6",{class:"step-title"},"Payment Information")],-1)),t("div",kt,[t("div",Mt,[t("div",St,[t("span",null,n(l.rentalForm.quantity)+" Ã— "+n(l.selectedItem?.name),1),t("span",null,n(o.formatCurrency(l.selectedItem?.price_per_day))+"/day",1)]),t("div",xt,[t("span",null,"Ã— "+n(l.rentalForm.days)+" days",1),t("span",null,n(o.formatCurrency(l.selectedItem?.price_per_day*l.rentalForm.days)),1)]),t("div",Rt,[s[37]||(s[37]=t("span",null,"Total Cost",-1)),t("span",wt,n(o.formatCurrency(l.rentalForm.total_cost)),1)])]),t("div",Tt,[s[45]||(s[45]=t("label",{class:"form-label"},[t("i",{class:"fas fa-credit-card me-2"}),r("Payment Method ")],-1)),t("div",Et,[(d(!0),i(_,null,b(l.paymentMethods,a=>(d(),i("div",{key:a.id,class:f(["payment-option",{active:l.rentalForm.payment_method===a.id}]),onClick:g=>l.rentalForm.payment_method=a.id},[t("i",{class:f(a.icon)},null,2),t("span",null,n(a.name),1)],10,Pt))),128))]),["airtel","mtn"].includes(l.rentalForm.payment_method)?(d(),i("div",Ut,[t("div",Vt,[s[43]||(s[43]=t("i",{class:"fas fa-info-circle me-2"},null,-1)),s[44]||(s[44]=t("strong",null,"Mobile Money Instructions:",-1)),t("ul",Ot,[s[40]||(s[40]=t("li",null,"Go to your Mobile Money menu",-1)),s[41]||(s[41]=t("li",null,'Select "Send Money"',-1)),s[42]||(s[42]=t("li",null,[r("Enter our choir number: "),t("strong",null,"0753 123 456")],-1)),t("li",null,[s[38]||(s[38]=r("Amount: ",-1)),t("strong",null,n(o.formatCurrency(l.rentalForm.total_cost)),1)]),t("li",null,[s[39]||(s[39]=r("Reference: ",-1)),t("strong",null,"RENTAL-"+n(l.selectedItem?.name?.substring(0,8).toUpperCase()),1)])])])])):y("",!0)])])])])]),t("div",Nt,[s[48]||(s[48]=t("button",{class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},[t("i",{class:"fas fa-times me-2"}),r(" Cancel ")],-1)),t("button",{type:"submit",class:"btn btn-primary",onClick:s[9]||(s[9]=(...a)=>o.submitRental&&o.submitRental(...a)),disabled:!o.isFormValid},[...s[47]||(s[47]=[t("i",{class:"fas fa-paper-plane me-2"},null,-1),r(" Submit Rental Request ",-1)])],8,Lt)])])])])])}const Gt=F(q,[["render",At],["__scopeId","data-v-a5a80ca9"]]);export{Gt as default};
