import{_ as x,a as r,o as a,b as e,t as n,d as c,m,i as w,z as k,F as b,r as f,n as _,s as p,y as v,v as C,k as M,p as g}from"./index-DSpDc2Ld.js";const S={name:"ChoirMemberModal",props:{member:{type:Object,required:!0}},methods:{closeModal(){const s=this.$refs.modalRef;s&&(bootstrap.Modal.getInstance(s)||new bootstrap.Modal(s)).hide(),this.$emit("close")},formatDate(s){return s?new Date(s).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"}):"-"}}},V={class:"modal fade",id:"choirMemberModal",tabindex:"-1","aria-labelledby":"choirMemberModalLabel","aria-hidden":"true",ref:"modalRef"},D={class:"modal-dialog modal-lg modal-dialog-centered"},R={class:"modal-content"},A={class:"modal-header bg-primary text-white"},U={class:"modal-title",id:"choirMemberModalLabel"},L={class:"modal-body"},E={class:"row"},j={class:"col-md-4 text-center mb-3"},B=["src"],I={key:1,class:"placeholder rounded-circle bg-secondary p-5"},T={class:"col-md-8"},F={class:"list-group list-group-flush"},N={class:"list-group-item"},Q={class:"list-group-item"},z={key:0,class:"list-group-item"},P={key:1,class:"list-group-item"},J={key:2,class:"list-group-item"},O={key:3,class:"list-group-item"},q={key:4,class:"list-group-item"},G={class:"modal-footer"};function H(s,t,i,y,d,o){return a(),r("div",V,[e("div",D,[e("div",R,[e("div",A,[e("h5",U,n(i.member?.username||"Choir Member Details"),1),e("button",{type:"button",class:"btn-close btn-close-white",onClick:t[0]||(t[0]=(...h)=>o.closeModal&&o.closeModal(...h)),"aria-label":"Close"})]),e("div",L,[e("div",E,[e("div",j,[i.member?.profile_picture?(a(),r("img",{key:0,src:i.member.profile_picture,alt:"Profile Picture",class:"img-fluid rounded-circle shadow-sm"},null,8,B)):(a(),r("div",I," No Image "))]),e("div",T,[e("ul",F,[e("li",N,[t[3]||(t[3]=e("strong",null,"Full Name:",-1)),m(" "+n(i.member?.first_name)+" "+n(i.member?.last_name),1)]),e("li",Q,[t[4]||(t[4]=e("strong",null,"Email:",-1)),m(" "+n(i.member?.email),1)]),i.member?.phone_number?(a(),r("li",z,[t[5]||(t[5]=e("strong",null,"Phone:",-1)),m(" "+n(i.member.phone_number),1)])):c("",!0),i.member?.profile?.section?(a(),r("li",P,[t[6]||(t[6]=e("strong",null,"Section:",-1)),m(" "+n(i.member.profile.section_display),1)])):c("",!0),i.member?.profile?.join_date?(a(),r("li",J,[t[7]||(t[7]=e("strong",null,"Join Date:",-1)),m(" "+n(o.formatDate(i.member.profile.join_date)),1)])):c("",!0),i.member?.profile?.emergency_contact?(a(),r("li",O,[t[8]||(t[8]=e("strong",null,"Emergency Contact:",-1)),m(" "+n(i.member.profile.emergency_contact),1)])):c("",!0),i.member?.profile?.bio?(a(),r("li",q,[t[9]||(t[9]=e("strong",null,"Bio:",-1)),m(" "+n(i.member.profile.bio),1)])):c("",!0)])])])]),e("div",G,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[1]||(t[1]=(...h)=>o.closeModal&&o.closeModal(...h))}," Close "),e("button",{type:"button",class:"btn btn-primary",onClick:t[2]||(t[2]=h=>s.$emit("edit-member",i.member))}," Edit Member ")])])])],512)}const K=x(S,[["render",H],["__scopeId","data-v-889c37c3"]]),W={name:"ChoirView",components:{ChoirMemberModal:K},data(){return{loading:!1,choirMembers:[],stats:{},filterVoice:"all",filterRole:"all",searchQuery:"",showModal:!1,editingMember:null,voiceTypes:["Soprano","Alto","Tenor","Bass","Other"],roles:["Member","Leader","Conductor","Instrumentalist"],currentUser:null}},computed:{filteredMembers(){return this.choirMembers.filter(s=>{const t=this.filterVoice==="all"||s.voice_type===this.filterVoice,i=this.filterRole==="all"||s.role===this.filterRole,y=this.searchQuery===""||s.user.toLowerCase().includes(this.searchQuery.toLowerCase());return t&&i&&y})},canAddMember(){return this.currentUser?.is_staff||this.currentUser?.is_superuser}},async mounted(){await this.loadCurrentUser(),await this.loadChoirMembers(),await this.loadStats()},methods:{async loadCurrentUser(){try{const s=await g.auth.getCurrentUser();this.currentUser=s.data}catch(s){console.error("Failed to fetch user:",s)}},async loadChoirMembers(){this.loading=!0;try{const s=await g.choir.members.list();this.choirMembers=s.data.results||s.data}catch(s){console.error("Failed to load members:",s)}finally{this.loading=!1}},async loadStats(){try{const s=await g.choir.members.stats();this.stats={total_members:s.data.total_members,...s.data.voice_distribution.reduce((t,i)=>(t[i.voice_type]=i.count,t),{})}}catch(s){console.error("Failed to load stats:",s)}},formatDate(s){return new Date(s).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})},formatStatLabel(s){return s.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase())},getStatIcon(s){switch(s){case"total_members":return"fas fa-users";case"Soprano":case"Alto":case"Tenor":case"Bass":return"fas fa-microphone-alt";default:return"fas fa-user"}},canEditMember(s){return this.currentUser?.is_staff||this.currentUser?.is_superuser},getRoleBadgeClass(s){return{Leader:"bg-warning text-dark",Conductor:"bg-info text-white",Instrumentalist:"bg-success text-white",Member:"bg-secondary text-white"}[s]||"bg-light text-dark"},getAttendanceClass(s){return s>=90?"bg-success":s>=70?"bg-warning":"bg-danger"},openModal(s=null){this.editingMember=s,this.showModal=!0},closeModal(){this.editingMember=null,this.showModal=!1},editMember(s){this.openModal(s)},async deleteMember(s){if(confirm(`Are you sure you want to delete ${s.user}?`))try{await g.choir.members.delete(s.id),this.choirMembers=this.choirMembers.filter(t=>t.id!==s.id),alert(`${s.user} deleted successfully.`)}catch(t){console.error("Delete failed:",t),alert("Failed to delete member.")}},async reloadMembers(){await this.loadChoirMembers(),await this.loadStats(),this.closeModal()}}},X={class:"choir-management-page"},Y={class:"page-header bg-white border-bottom py-4 mb-4"},Z={class:"container-fluid"},$={class:"d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center"},ee={class:"container-fluid"},te={class:"row g-3 mb-4"},se={class:"card stat-card h-100 border-0 shadow-sm"},le={class:"card-body text-center p-3"},oe={class:"stat-value fw-bold text-dark mb-1"},ae={class:"stat-label text-muted small mb-0 text-uppercase"},re={class:"card border-0 shadow-sm mb-4"},ie={class:"card-body"},ne={class:"row g-3 align-items-center"},de={class:"col-12 col-md-auto"},ce=["value"],me={class:"col-12 col-md-auto"},ue=["value"],be={class:"col-12 col-md"},he={class:"input-group"},fe={class:"card border-0 shadow-sm"},_e={class:"card-body p-0"},ge={key:0,class:"text-center py-5"},ye={key:0,class:"text-center py-5"},pe={class:"table-responsive d-none d-md-block"},ve={class:"table table-hover align-middle mb-0"},Me={class:"ps-4"},xe={class:"d-flex align-items-center"},we={class:"fw-medium text-dark"},ke={class:"badge voice-badge bg-light text-dark border"},Ce={class:"text-muted small"},Se={class:"d-flex align-items-center"},Ve={class:"attendance-bar me-2 flex-grow-1"},De={class:"attendance-percentage small fw-medium"},Re={class:"text-end pe-4"},Ae={class:"btn-group btn-group-sm",role:"group"},Ue=["onClick"],Le=["onClick"],Ee={class:"d-md-none"},je={class:"row g-3 p-3"},Be={class:"card member-card border-0 shadow-sm"},Ie={class:"card-body"},Te={class:"d-flex justify-content-between align-items-start mb-3"},Fe={class:"d-flex align-items-center"},Ne={class:"fw-bold mb-0 text-dark"},Qe={class:"text-muted"},ze={class:"btn-group btn-group-sm",role:"group"},Pe=["onClick"],Je=["onClick"],Oe={class:"row g-2"},qe={class:"col-6"},Ge={class:"badge voice-badge bg-light text-dark border"},He={class:"col-6"},Ke={class:"col-12 mt-2"},We={class:"d-flex align-items-center"},Xe={class:"attendance-bar me-2 flex-grow-1"},Ye={class:"attendance-percentage small fw-medium"};function Ze(s,t,i,y,d,o){const h=w("ChoirMemberModal");return a(),r("div",X,[e("header",Y,[e("div",Z,[e("div",$,[t[5]||(t[5]=e("div",{class:"mb-3 mb-md-0"},[e("h1",{class:"h2 mb-1 text-dark fw-bold"},[e("i",{class:"fas fa-users text-primary me-2"}),m("Choir Management ")]),e("p",{class:"text-muted mb-0"},"Manage choir members, roles, and attendance")],-1)),o.canAddMember?(a(),r("button",{key:0,class:"btn btn-primary px-4",onClick:t[0]||(t[0]=l=>o.openModal())},[...t[4]||(t[4]=[e("i",{class:"fas fa-plus me-2"},null,-1),m("Add Member ",-1)])])):c("",!0)])])]),e("main",ee,[e("section",te,[(a(!0),r(b,null,f(d.stats,(l,u)=>(a(),r("div",{class:"col-6 col-md-3",key:u},[e("div",se,[e("div",le,[e("i",{class:_([o.getStatIcon(u),"stat-icon text-primary mb-2"])},null,2),e("h3",oe,n(l),1),e("p",ae,n(o.formatStatLabel(u)),1)])])]))),128))]),e("section",re,[e("div",ie,[e("div",ne,[e("div",de,[t[7]||(t[7]=e("label",{class:"form-label small text-muted mb-1 fw-medium"},"Voice Type",-1)),p(e("select",{"onUpdate:modelValue":t[1]||(t[1]=l=>d.filterVoice=l),class:"form-select"},[t[6]||(t[6]=e("option",{value:"all"},"All Voices",-1)),(a(!0),r(b,null,f(d.voiceTypes,l=>(a(),r("option",{key:l,value:l},n(l),9,ce))),128))],512),[[v,d.filterVoice]])]),e("div",me,[t[9]||(t[9]=e("label",{class:"form-label small text-muted mb-1 fw-medium"},"Role",-1)),p(e("select",{"onUpdate:modelValue":t[2]||(t[2]=l=>d.filterRole=l),class:"form-select"},[t[8]||(t[8]=e("option",{value:"all"},"All Roles",-1)),(a(!0),r(b,null,f(d.roles,l=>(a(),r("option",{key:l,value:l},n(l),9,ue))),128))],512),[[v,d.filterRole]])]),e("div",be,[t[11]||(t[11]=e("label",{class:"form-label small text-muted mb-1 fw-medium"},"Search Members",-1)),e("div",he,[t[10]||(t[10]=e("span",{class:"input-group-text bg-light border-end-0"},[e("i",{class:"fas fa-search text-muted"})],-1)),p(e("input",{type:"text",class:"form-control border-start-0",placeholder:"Search by name or username...","onUpdate:modelValue":t[3]||(t[3]=l=>d.searchQuery=l)},null,512),[[C,d.searchQuery]])])])])])]),e("section",fe,[t[24]||(t[24]=e("div",{class:"card-header bg-light border-0 py-3"},[e("h3",{class:"card-title h6 mb-0 fw-bold text-dark"},[e("i",{class:"fas fa-list me-2 text-primary"}),m("Choir Members ")])],-1)),e("div",_e,[d.loading?(a(),r("div",ge,[...t[12]||(t[12]=[e("div",{class:"spinner-border text-primary",role:"status"},null,-1),e("p",{class:"mt-2 text-muted small"},"Loading choir members...",-1)])])):(a(),r(b,{key:1},[o.filteredMembers.length===0?(a(),r("div",ye,[...t[13]||(t[13]=[e("i",{class:"fas fa-users fa-2x text-muted mb-3"},null,-1),e("h4",{class:"text-muted"},"No members found",-1),e("p",{class:"text-muted"},"Try adjusting your search or filters",-1)])])):(a(),r(b,{key:1},[e("div",pe,[e("table",ve,[t[17]||(t[17]=e("thead",{class:"table-light"},[e("tr",null,[e("th",{scope:"col",class:"ps-4"},"Member"),e("th",{scope:"col"},"Voice"),e("th",{scope:"col"},"Role"),e("th",{scope:"col"},"Joined"),e("th",{scope:"col"},"Attendance"),e("th",{scope:"col",class:"text-end pe-4"},"Actions")])],-1)),e("tbody",null,[(a(!0),r(b,null,f(o.filteredMembers,l=>(a(),r("tr",{key:l.id,class:"member-row"},[e("td",Me,[e("div",xe,[t[14]||(t[14]=e("div",{class:"member-avatar bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3"},[e("i",{class:"fas fa-user fa-sm"})],-1)),e("div",null,[e("div",we,n(l.user),1)])])]),e("td",null,[e("span",ke,n(l.voice_type),1)]),e("td",null,[e("span",{class:_(["badge role-badge",o.getRoleBadgeClass(l.role)])},n(l.role),3)]),e("td",Ce,n(o.formatDate(l.joined_on)),1),e("td",null,[e("div",Se,[e("div",Ve,[e("div",{class:_(["attendance-progress",o.getAttendanceClass(l.attendance_percentage)]),style:M({width:l.attendance_percentage+"%"})},null,6)]),e("span",De,n(l.attendance_percentage)+"% ",1)])]),e("td",Re,[e("div",Ae,[o.canEditMember(l)?(a(),r("button",{key:0,class:"btn btn-outline-primary",onClick:u=>o.editMember(l),title:"Edit member"},[...t[15]||(t[15]=[e("i",{class:"fas fa-edit"},null,-1)])],8,Ue)):c("",!0),o.canEditMember(l)?(a(),r("button",{key:1,class:"btn btn-outline-danger",onClick:u=>o.deleteMember(l),title:"Delete member"},[...t[16]||(t[16]=[e("i",{class:"fas fa-trash-alt"},null,-1)])],8,Le)):c("",!0)])])]))),128))])])]),e("div",Ee,[e("div",je,[(a(!0),r(b,null,f(o.filteredMembers,l=>(a(),r("div",{key:l.id,class:"col-12"},[e("div",Be,[e("div",Ie,[e("div",Te,[e("div",Fe,[t[18]||(t[18]=e("div",{class:"member-avatar bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3"},[e("i",{class:"fas fa-user fa-sm"})],-1)),e("div",null,[e("h6",Ne,n(l.user),1),e("small",Qe,"Member since "+n(o.formatDate(l.joined_on)),1)])]),e("div",ze,[o.canEditMember(l)?(a(),r("button",{key:0,class:"btn btn-outline-primary btn-sm",onClick:u=>o.editMember(l)},[...t[19]||(t[19]=[e("i",{class:"fas fa-edit"},null,-1)])],8,Pe)):c("",!0),o.canEditMember(l)?(a(),r("button",{key:1,class:"btn btn-outline-danger btn-sm",onClick:u=>o.deleteMember(l)},[...t[20]||(t[20]=[e("i",{class:"fas fa-trash-alt"},null,-1)])],8,Je)):c("",!0)])]),e("div",Oe,[e("div",qe,[t[21]||(t[21]=e("small",{class:"text-muted d-block"},"Voice",-1)),e("span",Ge,n(l.voice_type),1)]),e("div",He,[t[22]||(t[22]=e("small",{class:"text-muted d-block"},"Role",-1)),e("span",{class:_(["badge role-badge",o.getRoleBadgeClass(l.role)])},n(l.role),3)]),e("div",Ke,[t[23]||(t[23]=e("small",{class:"text-muted d-block mb-1"},"Attendance",-1)),e("div",We,[e("div",Xe,[e("div",{class:_(["attendance-progress",o.getAttendanceClass(l.attendance_percentage)]),style:M({width:l.attendance_percentage+"%"})},null,6)]),e("span",Ye,n(l.attendance_percentage)+"% ",1)])])])])])]))),128))])])],64))],64))])])]),d.showModal?(a(),k(h,{key:0,member:d.editingMember,onClose:o.closeModal,onSaved:o.reloadMembers},null,8,["member","onClose","onSaved"])):c("",!0)])}const et=x(W,[["render",Ze],["__scopeId","data-v-1e51fba8"]]);export{et as default};
