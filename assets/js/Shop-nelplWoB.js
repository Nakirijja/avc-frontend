import{_ as P,a as i,o as n,l as y,b as s,d as u,m as d,t as l,s as f,v as x,y as v,F as m,r as p,n as b,p as k,x as _}from"./index-DSpDc2Ld.js";var C={};const w={name:"ShopPage",data(){return{products:[],categories:[],loading:!0,error:!1,searchQuery:"",selectedCategory:"",sortBy:"-created_at",cart:[],showCart:!1,currentPage:1,totalPages:1,totalProducts:0,pageSize:12,searchTimeout:null}},computed:{isAuthenticated(){return _.isAuthenticated()},cartTotalItems(){return this.cart.reduce((e,t)=>e+t.quantity,0)},cartSubtotal(){return this.cart.reduce((e,t)=>e+t.price*t.quantity,0)},shipping(){return this.cart.length>0?5e3:0},cartTotal(){return this.cartSubtotal+this.shipping},visiblePages(){const e=[],t=Math.max(1,this.currentPage-2),c=Math.min(this.totalPages,this.currentPage+2);for(let h=t;h<=c;h++)e.push(h);return e}},methods:{async fetchProducts(){this.loading=!0,this.error=!1;try{const e={page:this.currentPage,page_size:this.pageSize};this.selectedCategory&&(e.category=this.selectedCategory),this.searchQuery&&(e.search=this.searchQuery),this.sortBy&&(e.ordering=this.sortBy),console.log("Fetching products with params:",e);const t=await k.shop.getProducts(e);console.log("API Response:",t.data),this.products=t.data.results||t.data,this.totalProducts=t.data.count||this.products.length,this.totalPages=Math.ceil(this.totalProducts/this.pageSize)||1}catch(e){console.error("Products fetch error:",e),this.error=!0,this.products=this.getFallbackProducts()}finally{this.loading=!1}},async fetchCategories(){try{const e=await k.shop.getCategories();this.categories=e.data.results||e.data}catch(e){console.error("Categories fetch error:",e),this.categories=this.getFallbackCategories()}},getProductImage(e){return e?e.startsWith("http")?e:e.startsWith("/media/")?`${C.VUE_APP_API_URL||"http://localhost:8000"}${e}`:`${C.VUE_APP_API_URL||"http://localhost:8000"}/media/${e}`:"https://picsum.photos/300/200?random=99"},handleImageError(e){console.log("Image failed to load, using placeholder"),e.target.src="https://picsum.photos/300/200?random=99"},truncateDescription(e){return e?e.length>100?e.substring(0,100)+"...":e:"No description available"},formatPrice(e){return new Intl.NumberFormat("en-US").format(e)},getCategoryName(e){const t=this.categories.find(c=>c.id===e);return t?t.name:"Uncategorized"},addToCart(e){if(!e.is_in_stock||e.stock===0){this.showMessage("This product is out of stock");return}const t=this.cart.find(c=>c.id===e.id);if(t){if(t.quantity>=e.stock){this.showMessage(`Only ${e.stock} items available in stock`);return}t.quantity+=1}else this.cart.push({...e,quantity:1,max_stock:e.stock});this.showCart=!0,this.showMessage(`${e.name} added to cart!`)},updateQuantity(e,t){if(t<1){this.removeFromCart(e);return}const c=this.cart.find(h=>h.id===e);if(c){if(t>c.max_stock){this.showMessage(`Only ${c.max_stock} items available`);return}c.quantity=t}},removeFromCart(e){this.cart=this.cart.filter(t=>t.id!==e),this.showMessage("Item removed from cart")},toggleCart(){this.showCart=!this.showCart},goToLogin(){this.$router.push("/auth/login")},proceedToCheckout(){if(this.cart.length===0){this.showMessage("Your cart is empty");return}if(!this.isAuthenticated){this.showMessage("Please log in to proceed with checkout"),this.$router.push("/auth/login");return}alert(`Checkout functionality coming soon!

Items: ${this.cartTotalItems}
Total: UGX ${this.formatPrice(this.cartTotal)}`)},handleSearch(){clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.currentPage=1,this.fetchProducts()},500)},changePage(e){e>=1&&e<=this.totalPages&&e!==this.currentPage&&(this.currentPage=e,this.fetchProducts(),window.scrollTo({top:0,behavior:"smooth"}))},clearFilters(){this.searchQuery="",this.selectedCategory="",this.sortBy="-created_at",this.currentPage=1,this.fetchProducts()},showMessage(e){console.log(e)},getFallbackProducts(){return[{id:1,name:"Choir T-Shirt",price:25e3,description:"Official AVC Choir T-Shirt with logo",image:"https://picsum.photos/300/200?random=1",stock:10,is_in_stock:!0,category:1},{id:2,name:"Worship CD",price:15e3,description:"Latest worship album from AVC Choir",image:"https://picsum.photos/300/200?random=2",stock:5,is_in_stock:!0,category:2}]},getFallbackCategories(){return[{id:1,name:"Clothing"},{id:2,name:"Music"},{id:3,name:"Accessories"}]}},mounted(){console.log("Shop component mounted - fetching from database"),this.fetchProducts(),this.fetchCategories();try{const e=localStorage.getItem("avc_shop_cart");e&&(this.cart=JSON.parse(e))}catch(e){console.error("Error loading cart from storage:",e)}},watch:{cart:{handler(e){try{localStorage.setItem("avc_shop_cart",JSON.stringify(e))}catch(t){console.error("Error saving cart to storage:",t)}},deep:!0}}},S={class:"shop-container"},T={class:"container py-5"},I={class:"d-flex justify-content-between align-items-center mb-4"},A={class:"d-flex gap-2"},F={key:0,class:"position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"},M={class:"row mb-4"},N={class:"col-md-6"},q={class:"input-group"},L={class:"col-md-3"},V=["value"],j={class:"col-md-3"},U={key:0,class:"text-center py-5"},E={key:1,class:"alert alert-warning text-center"},B={key:2,class:"row"},O={class:"card product-card h-100 shadow-sm border-0"},Q={class:"card-img-container position-relative"},z=["src","alt"],G={key:0,class:"position-absolute top-0 start-0 m-2"},X={key:1,class:"position-absolute top-0 start-0 m-2"},D={class:"card-body d-flex flex-column"},R={class:"card-title fw-bold text-dark mb-2"},H={class:"card-text text-muted small flex-grow-1"},W={class:"mt-auto"},Y={class:"d-flex justify-content-between align-items-center mb-3"},J={class:"h5 text-primary mb-0"},Z={class:"badge bg-secondary"},K={class:"stock-info mb-2"},$={class:"text-muted"},tt=["onClick","disabled"],st={key:3,class:"text-center py-5"},et={class:"empty-state"},at={key:0,class:"text-muted mb-3"},ot={key:4,class:"d-flex justify-content-center mt-5"},rt={"aria-label":"Products pagination"},it={class:"pagination"},nt=["onClick"],lt={class:"ms-3 d-flex align-items-center"},ct={class:"text-muted"},dt={key:1,class:"cart-sidebar"},ut={class:"cart-header"},ht={class:"cart-body"},gt={key:0,class:"empty-cart text-center py-4"},mt={key:1,class:"cart-items"},pt=["src","alt"],ft={class:"cart-item-details"},bt={class:"text-primary mb-1"},yt={class:"cart-item-controls"},vt={class:"quantity-controls"},kt=["onClick","disabled"],Ct={class:"quantity mx-2"},Pt=["onClick","disabled"],xt=["onClick"],_t={key:0,class:"cart-footer"},wt={class:"cart-total mb-3 p-3 bg-light rounded"},St={class:"d-flex justify-content-between mb-2"},Tt={class:"d-flex justify-content-between mb-2"},It={class:"d-flex justify-content-between"},At={class:"text-primary"};function Ft(e,t,c,h,r,o){return n(),i("div",S,[t[50]||(t[50]=y('<section class="shop-header bg-light py-5" data-v-4d5a5863><div class="container" data-v-4d5a5863><div class="row justify-content-center text-center" data-v-4d5a5863><div class="col-lg-10" data-v-4d5a5863><div class="header-icon mb-4" data-v-4d5a5863><i class="fas fa-hands-helping fa-3x" data-v-4d5a5863></i></div><h1 class="display-5 fw-bold text-primary mb-3" data-v-4d5a5863>ðŸŽµ AVC Choir Shop</h1><p class="lead mb-0 mx-auto" style="max-width:600px;" data-v-4d5a5863> Support our ministry and spread the joy of worship through our official merchandise. Every purchase helps us continue our mission. </p><div class="d-flex justify-content-center flex-wrap gap-2" data-v-4d5a5863><span class="badge bg-primary" data-v-4d5a5863>Official Merchandise</span><span class="badge bg-success" data-v-4d5a5863>Quality Guaranteed</span><span class="badge bg-info" data-v-4d5a5863>Ministry Support</span></div></div></div></div></section>',1)),s("section",T,[s("div",I,[t[21]||(t[21]=s("h2",null,"Products",-1)),s("div",A,[o.isAuthenticated?u("",!0):(n(),i("button",{key:0,onClick:t[0]||(t[0]=(...a)=>o.goToLogin&&o.goToLogin(...a)),class:"btn btn-outline-primary"},[...t[18]||(t[18]=[s("i",{class:"fas fa-sign-in-alt"},null,-1),d(" Login ",-1)])])),s("button",{onClick:t[1]||(t[1]=(...a)=>o.toggleCart&&o.toggleCart(...a)),class:"btn btn-outline-primary position-relative"},[t[19]||(t[19]=s("i",{class:"fas fa-shopping-cart"},null,-1)),t[20]||(t[20]=d(" Cart ",-1)),r.cart.length>0?(n(),i("span",F,l(o.cartTotalItems),1)):u("",!0)])])]),s("div",M,[s("div",N,[s("div",q,[t[22]||(t[22]=s("span",{class:"input-group-text"},[s("i",{class:"fas fa-search"})],-1)),f(s("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>r.searchQuery=a),type:"text",class:"form-control",placeholder:"Search products by name or description...",onInput:t[3]||(t[3]=(...a)=>o.handleSearch&&o.handleSearch(...a))},null,544),[[x,r.searchQuery]])])]),s("div",L,[f(s("select",{"onUpdate:modelValue":t[4]||(t[4]=a=>r.selectedCategory=a),class:"form-select",onChange:t[5]||(t[5]=(...a)=>o.fetchProducts&&o.fetchProducts(...a))},[t[23]||(t[23]=s("option",{value:""},"All Categories",-1)),(n(!0),i(m,null,p(r.categories,a=>(n(),i("option",{key:a.id,value:a.id},l(a.name),9,V))),128))],544),[[v,r.selectedCategory]])]),s("div",j,[f(s("select",{"onUpdate:modelValue":t[6]||(t[6]=a=>r.sortBy=a),class:"form-select",onChange:t[7]||(t[7]=(...a)=>o.fetchProducts&&o.fetchProducts(...a))},[...t[24]||(t[24]=[y('<option value="" data-v-4d5a5863>Sort by</option><option value="name" data-v-4d5a5863>Name A-Z</option><option value="-name" data-v-4d5a5863>Name Z-A</option><option value="price" data-v-4d5a5863>Price: Low to High</option><option value="-price" data-v-4d5a5863>Price: High to Low</option><option value="-created_at" data-v-4d5a5863>Newest First</option><option value="created_at" data-v-4d5a5863>Oldest First</option>',7)])],544),[[v,r.sortBy]])])]),r.loading?(n(),i("div",U,[...t[25]||(t[25]=[s("div",{class:"spinner-border text-primary",role:"status"},[s("span",{class:"visually-hidden"},"Loading...")],-1),s("p",{class:"mt-3 text-muted"},"Loading products from database...",-1)])])):r.error?(n(),i("div",E,[t[27]||(t[27]=s("i",{class:"fas fa-exclamation-triangle me-2"},null,-1)),t[28]||(t[28]=s("strong",null,"Unable to load products",-1)),t[29]||(t[29]=s("p",{class:"mb-0"},"Please check your connection and try again.",-1)),s("button",{onClick:t[8]||(t[8]=(...a)=>o.fetchProducts&&o.fetchProducts(...a)),class:"btn btn-sm btn-warning mt-2"},[...t[26]||(t[26]=[s("i",{class:"fas fa-redo me-1"},null,-1),d(" Retry ",-1)])])])):r.products.length>0?(n(),i("div",B,[(n(!0),i(m,null,p(r.products,a=>(n(),i("div",{key:a.id,class:"col-xl-3 col-lg-4 col-md-6 mb-4"},[s("div",O,[s("div",Q,[s("img",{src:o.getProductImage(a.image),alt:a.name,class:"card-img-top product-image",style:{height:"200px","object-fit":"cover"},loading:"lazy",onError:t[9]||(t[9]=(...g)=>o.handleImageError&&o.handleImageError(...g))},null,40,z),a.is_in_stock?a.stock<10?(n(),i("div",X,[...t[31]||(t[31]=[s("span",{class:"badge bg-warning text-dark"},"Low Stock",-1)])])):u("",!0):(n(),i("div",G,[...t[30]||(t[30]=[s("span",{class:"badge bg-danger"},"Out of Stock",-1)])]))]),s("div",D,[s("h5",R,l(a.name),1),s("p",H,l(o.truncateDescription(a.description)),1),s("div",W,[s("div",Y,[s("span",J,"UGX "+l(o.formatPrice(a.price)),1),s("span",Z,l(o.getCategoryName(a.category)),1)]),s("div",K,[s("small",$,[t[32]||(t[32]=s("i",{class:"fas fa-box me-1"},null,-1)),d(" "+l(a.stock)+" in stock ",1)])]),s("button",{class:"btn btn-primary w-100",onClick:g=>o.addToCart(a),disabled:!a.is_in_stock||a.stock===0},[t[33]||(t[33]=s("i",{class:"fas fa-cart-plus"},null,-1)),d(" "+l(a.stock>0?"Add to Cart":"Out of Stock"),1)],8,tt)])])])]))),128))])):(n(),i("div",st,[s("div",et,[t[35]||(t[35]=s("i",{class:"fas fa-search fa-3x text-muted mb-3"},null,-1)),t[36]||(t[36]=s("h4",{class:"text-muted"},"No products found",-1)),r.searchQuery||r.selectedCategory?(n(),i("p",at," Try adjusting your search or filter criteria ")):u("",!0),s("button",{class:"btn btn-outline-primary",onClick:t[10]||(t[10]=(...a)=>o.clearFilters&&o.clearFilters(...a))},[...t[34]||(t[34]=[s("i",{class:"fas fa-times me-1"},null,-1),d(" Clear Filters ",-1)])])])])),!r.loading&&r.totalPages>1?(n(),i("div",ot,[s("nav",rt,[s("ul",it,[s("li",{class:b(["page-item",{disabled:r.currentPage===1}])},[s("button",{class:"page-link",onClick:t[11]||(t[11]=a=>o.changePage(r.currentPage-1))},[...t[37]||(t[37]=[s("i",{class:"fas fa-chevron-left"},null,-1),d(" Previous ",-1)])])],2),(n(!0),i(m,null,p(o.visiblePages,a=>(n(),i("li",{key:a,class:b(["page-item",{active:a===r.currentPage}])},[s("button",{class:"page-link",onClick:g=>o.changePage(a)},l(a),9,nt)],2))),128)),s("li",{class:b(["page-item",{disabled:r.currentPage===r.totalPages}])},[s("button",{class:"page-link",onClick:t[12]||(t[12]=a=>o.changePage(r.currentPage+1))},[...t[38]||(t[38]=[d(" Next ",-1),s("i",{class:"fas fa-chevron-right"},null,-1)])])],2)])]),s("div",lt,[s("small",ct," Page "+l(r.currentPage)+" of "+l(r.totalPages)+" ("+l(r.totalProducts)+" products) ",1)])])):u("",!0)]),r.showCart?(n(),i("div",{key:0,class:"cart-overlay",onClick:t[13]||(t[13]=a=>r.showCart=!1)})):u("",!0),r.showCart?(n(),i("div",dt,[s("div",ut,[s("h4",null,[t[39]||(t[39]=s("i",{class:"fas fa-shopping-cart me-2"},null,-1)),d(" Your Cart ("+l(o.cartTotalItems)+") ",1)]),s("button",{onClick:t[14]||(t[14]=a=>r.showCart=!1),class:"btn-close"})]),s("div",ht,[r.cart.length===0?(n(),i("div",gt,[t[40]||(t[40]=s("i",{class:"fas fa-shopping-cart fa-3x text-muted mb-3"},null,-1)),t[41]||(t[41]=s("p",{class:"text-muted"},"Your cart is empty",-1)),s("button",{onClick:t[15]||(t[15]=a=>r.showCart=!1),class:"btn btn-outline-primary"}," Continue Shopping ")])):(n(),i("div",mt,[(n(!0),i(m,null,p(r.cart,a=>(n(),i("div",{key:a.id,class:"cart-item"},[s("img",{src:a.image,alt:a.name,class:"cart-item-image"},null,8,pt),s("div",ft,[s("h6",null,l(a.name),1),s("p",bt,"UGX "+l(o.formatPrice(a.price)),1),s("div",yt,[s("div",vt,[s("button",{class:"btn btn-sm btn-outline-secondary",onClick:g=>o.updateQuantity(a.id,a.quantity-1),disabled:a.quantity<=1},[...t[42]||(t[42]=[s("i",{class:"fas fa-minus"},null,-1)])],8,kt),s("span",Ct,l(a.quantity),1),s("button",{class:"btn btn-sm btn-outline-secondary",onClick:g=>o.updateQuantity(a.id,a.quantity+1),disabled:a.quantity>=a.max_stock},[...t[43]||(t[43]=[s("i",{class:"fas fa-plus"},null,-1)])],8,Pt)]),s("button",{onClick:g=>o.removeFromCart(a.id),class:"btn btn-sm btn-outline-danger ms-2"},[...t[44]||(t[44]=[s("i",{class:"fas fa-trash"},null,-1)])],8,xt)])])]))),128))]))]),r.cart.length>0?(n(),i("div",_t,[s("div",wt,[s("div",St,[t[45]||(t[45]=s("span",null,"Subtotal:",-1)),s("span",null,"UGX "+l(o.formatPrice(o.cartSubtotal)),1)]),s("div",Tt,[t[46]||(t[46]=s("span",null,"Shipping:",-1)),s("span",null,"UGX "+l(o.formatPrice(o.shipping)),1)]),t[48]||(t[48]=s("hr",null,null,-1)),s("div",It,[t[47]||(t[47]=s("strong",null,"Total:",-1)),s("strong",At,"UGX "+l(o.formatPrice(o.cartTotal)),1)])]),s("button",{onClick:t[16]||(t[16]=(...a)=>o.proceedToCheckout&&o.proceedToCheckout(...a)),class:"btn btn-primary w-100 mb-2"},[...t[49]||(t[49]=[s("i",{class:"fas fa-lock me-2"},null,-1),d(" Proceed to Checkout ",-1)])]),s("button",{onClick:t[17]||(t[17]=a=>r.showCart=!1),class:"btn btn-outline-secondary w-100"}," Continue Shopping ")])):u("",!0)])):u("",!0)])}const Nt=P(w,[["render",Ft],["__scopeId","data-v-4d5a5863"]]);export{Nt as default};
